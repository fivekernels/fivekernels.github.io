<!DOCTYPE html>
<html lang="zh-cn" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>STM32 UART LL Library | èƒ¡å†™ä¹±ç”»</title>
<meta name="keywords" content="STM32, CubeMX, UART, L4">
<meta name="description" content="UART æ¡†å›¾ æŸ¥çœ‹èŠ¯ç‰‡å¯¹åº”çš„ Reference Manual çš„ USART/UART ç« èŠ‚å¯ä»¥æ‰¾åˆ°å…¶æ¡†å›¾ã€‚ä»¥ F4 ç³»åˆ—çš„å‚è€ƒæ‰‹å†Œä¸ºä¾‹ï¼Œå…¶æ¡†å›¾å¦‚ä¸‹1ï¼š å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå‘é€çš„æ•°æ®ï¼Œä¾æ¬¡ç»è¿‡ TDR å¯„å­˜å™¨ -&gt; å‘é€ç§»ä½å¯„">
<meta name="author" content="hey">
<link rel="canonical" href="https://fivekernels.github.io/posts/stm32-uart-ll/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.193f5e1cb1ec7f5edeaea1140916a7023d6d6c087917077bf463fe5ee3727903.css" integrity="sha256-GT9eHLHsf17erqEUCRanAj1tbAh5Fwd79GP&#43;XuNyeQM=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://fivekernels.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://fivekernels.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://fivekernels.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://fivekernels.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://fivekernels.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="STM32 UART LL Library" />
<meta property="og:description" content="UART æ¡†å›¾ æŸ¥çœ‹èŠ¯ç‰‡å¯¹åº”çš„ Reference Manual çš„ USART/UART ç« èŠ‚å¯ä»¥æ‰¾åˆ°å…¶æ¡†å›¾ã€‚ä»¥ F4 ç³»åˆ—çš„å‚è€ƒæ‰‹å†Œä¸ºä¾‹ï¼Œå…¶æ¡†å›¾å¦‚ä¸‹1ï¼š å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå‘é€çš„æ•°æ®ï¼Œä¾æ¬¡ç»è¿‡ TDR å¯„å­˜å™¨ -&gt; å‘é€ç§»ä½å¯„" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://fivekernels.github.io/posts/stm32-uart-ll/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-02T17:08:13+08:00" />
<meta property="article:modified_time" content="2023-02-25T17:27:00+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="STM32 UART LL Library"/>
<meta name="twitter:description" content="UART æ¡†å›¾ æŸ¥çœ‹èŠ¯ç‰‡å¯¹åº”çš„ Reference Manual çš„ USART/UART ç« èŠ‚å¯ä»¥æ‰¾åˆ°å…¶æ¡†å›¾ã€‚ä»¥ F4 ç³»åˆ—çš„å‚è€ƒæ‰‹å†Œä¸ºä¾‹ï¼Œå…¶æ¡†å›¾å¦‚ä¸‹1ï¼š å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå‘é€çš„æ•°æ®ï¼Œä¾æ¬¡ç»è¿‡ TDR å¯„å­˜å™¨ -&gt; å‘é€ç§»ä½å¯„"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "https://fivekernels.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "STM32 UART LL Library",
      "item": "https://fivekernels.github.io/posts/stm32-uart-ll/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "STM32 UART LL Library",
  "name": "STM32 UART LL Library",
  "description": "UART æ¡†å›¾ æŸ¥çœ‹èŠ¯ç‰‡å¯¹åº”çš„ Reference Manual çš„ USART/UART ç« èŠ‚å¯ä»¥æ‰¾åˆ°å…¶æ¡†å›¾ã€‚ä»¥ F4 ç³»åˆ—çš„å‚è€ƒæ‰‹å†Œä¸ºä¾‹ï¼Œå…¶æ¡†å›¾å¦‚ä¸‹1ï¼š å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå‘é€çš„æ•°æ®ï¼Œä¾æ¬¡ç»è¿‡ TDR å¯„å­˜å™¨ -\u0026gt; å‘é€ç§»ä½å¯„",
  "keywords": [
    "STM32", "CubeMX", "UART", "L4"
  ],
  "articleBody": "UART æ¡†å›¾ æŸ¥çœ‹èŠ¯ç‰‡å¯¹åº”çš„ Reference Manual çš„ USART/UART ç« èŠ‚å¯ä»¥æ‰¾åˆ°å…¶æ¡†å›¾ã€‚ä»¥ F4 ç³»åˆ—çš„å‚è€ƒæ‰‹å†Œä¸ºä¾‹ï¼Œå…¶æ¡†å›¾å¦‚ä¸‹1ï¼š\nå¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå‘é€çš„æ•°æ®ï¼Œä¾æ¬¡ç»è¿‡ TDR å¯„å­˜å™¨ -\u003e å‘é€ç§»ä½å¯„å­˜å™¨ -\u003e TX ç«¯å£ï¼›å¯¹äºæ¥æ”¶çš„æ•°æ®ï¼Œä» RX ç«¯å£ä¾æ¬¡ç»è¿‡ æ¥æ”¶ç§»ä½å¯„å­˜å™¨ -\u003e RDRå¯„å­˜å™¨ã€‚\nUART å¯„å­˜å™¨ RXNE(Read data register not empty)ï¼šå½“æ¥æ”¶ç§»ä½å¯„å­˜å™¨ä¸­çš„æ•°æ®è¢«ä¼ é€åˆ° RDR å¯„å­˜å™¨æ—¶ï¼Œè¯¥ä½è¢«ç½®1ï¼›è‹¥æ‰“å¼€ä¸²å£æ¥æ”¶ä¸­æ–­(RXNEIE)=1æ—¶ï¼Œä¼šäº§ç”Ÿä¸­æ–­ã€‚è¯»å– RDR å¯„å­˜å™¨è¯¥ä½è‡ªåŠ¨æ¸…é›¶ã€‚ TXE(Transmit data register empty)ï¼šå½“TDR å¯„å­˜å™¨ä¸­çš„æ•°æ®è¢«ä¼ é€åˆ°å‘é€ç§»ä½å¯„å­˜å™¨æ—¶ï¼ˆæ­¤æ—¶å¯ä»¥å‘ TDR å¯„å­˜å™¨å†™å…¥æ–°æ•°æ®å‘é€ï¼‰ï¼Œè¯¥ä½è¢«ç½®1ï¼›è‹¥æ‰“å¼€ä¸²å£å‘é€ä¸­æ–­(TXEIE=1)æ—¶ï¼Œä¼šäº§ç”Ÿä¸­æ–­ã€‚å½“å‘ TDR å¯„å­˜å™¨ä¸­å†™å…¥æ–°æ•°æ®æ—¶è¯¥ä½è‡ªåŠ¨æ¸…é›¶ã€‚ TC(Transmission complete)ï¼šå½“ç§»ä½å¯„å­˜å™¨çš„æ•°æ®å‘é€å®Œæˆä¸” TDR å¯„å­˜å™¨ä¸ºç©ºï¼ˆæ²¡æœ‰ä¸‹ä¸€ä¸ªè¦å‘é€çš„æ•°æ®äº†ï¼‰æ—¶ï¼Œè¯¥ä½è¢«ç½®1ï¼›è‹¥æ‰“å¼€å‘é€å®Œæˆä¸­æ–­(TCIE=1)æ—¶ï¼Œä¼šäº§ç”Ÿä¸­æ–­ã€‚å½“å‘ TDR å¯„å­˜å™¨ä¸­å†™å…¥æ–°æ•°æ®æ—¶è¯¥ä½è‡ªåŠ¨æ¸…é›¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ¸…é›¶ã€‚ IDLE(Idle line detected)ï¼šç©ºé—²ä½é’ˆå¯¹æ¥æ”¶è¿‡ç¨‹ï¼›å½“ä¸²å£æ¥æ”¶åˆ°ä¸€ä¸ªå­—èŠ‚åçš„ä¸€ä¸ªå‘¨æœŸå†…éƒ½æ²¡æœ‰æ£€æµ‹åˆ°èµ·å§‹ä½æ—¶ï¼ˆå³æ£€æµ‹åˆ° Idle frame ï¼‰ï¼Œ IDLE è¢«ç½®12 3ã€‚å½“ IDLE è¢«ç½®1åï¼Œåªæœ‰å†æ¬¡æ¥æ”¶åˆ°æ•°æ®åï¼ˆ RXNE ç½®1ï¼‰æ‰ä¼šæ£€æµ‹ä¸‹ä¸€æ¬¡ç©ºé—²ã€‚ ä½åŠŸè€—ä¸²å£çš„æ—¶é’Ÿå’Œæ³¢ç‰¹ç‡ å¯¹äºLPUARTï¼Œå…¶æ³¢ç‰¹ç‡å’Œå…¶æ—¶é’Ÿæºæœ‰éœ€è¦æ»¡è¶³ä¸€å®šå…³ç³»4ï¼š\nå³LPUARTçš„æ—¶é’Ÿæºé¢‘ç‡å¿…é¡»åœ¨3å€æ³¢ç‰¹ç‡åˆ°4096å€æ³¢ç‰¹ç‡ä¹‹é—´ã€‚\nå¯¹äºCubeMXç”Ÿæˆçš„å·¥ç¨‹ï¼ŒLPUARTçš„æ—¶é’Ÿæºé»˜è®¤ä¸ºPCLK1ï¼ˆ80Mï¼ŒSTM32L4ï¼‰ï¼Œå› æ­¤å…¶å¯ä»¥æä¾›çš„æœ€ä½é¢‘ç‡ä¸º 80 * 10^6 / 4096 = 19532 bpsã€‚è‹¥è¦ä½¿ç”¨9600bpsç­‰ä½çš„æ³¢ç‰¹ç‡åˆ™åº”è¯¥é¦–å…ˆä¿®æ”¹ Clock Configuration ä¸­çš„ LPUART çš„æ—¶é’Ÿæºä¸º HSI(16M)ï¼š\næ­¤æ—¶ï¼Œå…è®¸çš„æ³¢ç‰¹ç‡èŒƒå›´ä¸º3907bps~5.33Mbpsã€‚\nä¸­æ–­æ–¹å¼ CubeMX é…ç½® é€‰ä¸­éœ€è¦çš„ UARTï¼ŒMode é€‰æ‹© Asynchronousï¼Œå³å¼‚æ­¥é€šä¿¡æ–¹å¼ï¼›NVIC Settings ä¸­å‹¾é€‰ global interrupt å¹¶è®¾ç½®ä¼˜å…ˆçº§ã€‚é€‰æ‹©å¥½å¯¹åº”çš„ GPIO å¼•è„šåå°±å¯ä»¥ç”Ÿæˆå·¥ç¨‹äº†ã€‚\nä»£ç  å‚è€ƒ ST å›ºä»¶åº“ä¾‹ç¨‹ USART_Communication_Rx_IT5ã€USART_Communication_Tx_IT6ã€‚\nå®šä¹‰ç»“æ„ä½“ UartITModel 1 2 3 4 5 6 7 8 9 10 11 12 typedef struct { volatile uint8_t rxFlag; // æ¥æ”¶å®Œä¸€å¸§æ•°æ®æ ‡å¿—ä½ uint8_t rxLen; // å½“å‰æ•°æ®å¸§é•¿åº¦ uint8_t rxData[10]; // å½“å‰æ•°æ® uint8_t _rx_data_index; // ä¸‹ä¸€ä¸ªè¦æ¥æ”¶çš„å­—èŠ‚å­˜æ”¾çš„æ•°ç»„ä¸‹æ ‡ volatile uint8_t txBusy; // 0: ä¸²å£æ²¡æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€; 1: æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€ uint8_t txLen; // å¾…å‘é€çš„æ•°æ®æ€»é•¿åº¦ uint8_t txData[10]; // å¾…å‘é€çš„æ•°æ® uint8_t _tx_data_index; // ä¸‹ä¸€ä¸ªè¦å‘é€çš„å­—èŠ‚çš„æ•°ç»„ä¸‹æ ‡ } UartITModel_1010; 1 UartITModel_1010 Lpuart1ITModel = {0}; 1 extern UartITModel_1010 Lpuart1ITModel; é…ç½®ä¸²å£æ¥æ”¶ä¸­æ–­ ç”Ÿæˆçš„ä»£ç é»˜è®¤ä¼šä½¿èƒ½ä¸²å£ä¸­æ–­ï¼Œä½†å¹¶ä¸ä¼šå¼€å¯ä¸²å£çš„å‘é€æˆ–æ¥æ”¶ç­‰ä¸­æ–­ï¼š\næ·»åŠ å¹¶è°ƒç”¨ä»¥ä¸‹å‡½æ•°ä½¿èƒ½RXNEä¸­æ–­ï¼š\n1 2 3 4 5 6 7 8 9 10 void LPUART1_ITConfig(void); void LPUART1_ITConfig(void) { // if (LL_LPUART_IsActiveFlag_RXNE(LPUART1) == 1) // sometimes rxne is set after initialization // { // LL_LPUART_ReceiveData8(LPUART1); // clear rxne // } LL_LPUART_EnableIT_RXNE(LPUART1); /* Enable RXNE interrupts */ } ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆRXNEï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 /** * @brief This function handles LPUART1 global interrupt. */ void LPUART1_IRQHandler(void) { /* USER CODE BEGIN LPUART1_IRQn 0 */ if ((LL_USART_IsEnabledIT_RXNE(LPUART1) == 1) \u0026\u0026 (LL_USART_IsActiveFlag_RXNE(LPUART1) == 1)) // æ¥æ”¶åˆ°æ•°æ® { /* Read Received character. RXNE flag is cleared by reading of RDR register */ uint8_t rxdata = LL_USART_ReceiveData8(LPUART1); Lpuart1ITModel.rxData[Lpuart1ITModel._rx_data_index++] = rxdata; // data condition or rx array full if ((rxdata == 0xFF) || (Lpuart1ITModel._rx_data_index == sizeof(Lpuart1ITModel.rxData))) { Lpuart1ITModel.rxLen = Lpuart1ITModel._rx_data_index; Lpuart1ITModel._rx_data_index = 0; Lpuart1ITModel.rxFlag = 1; } } /* USER CODE END LPUART1_IRQn 0 */ /* USER CODE BEGIN LPUART1_IRQn 1 */ /* USER CODE END LPUART1_IRQn 1 */ } å‘é€æ•°æ® ä½¿ç”¨ä¸²å£ä¸­æ–­å‘é€æ•°æ®åªéœ€è¦å¼€å¯ TXE ä¸­æ–­ï¼Œåœ¨ä¸­æ–­ä¸­ä¾æ¬¡å°†éœ€è¦å‘é€çš„æ•°æ®å†™å…¥ TDR å¯„å­˜å™¨å³å¯ï¼›å†™å…¥æœ€åä¸€ä¸ªå­—èŠ‚åå¯ä»¥å…³é—­ TXE ä¸­æ–­ï¼›ä½†æ­¤æ—¶æœ€åä¸€ä¸ªå­—èŠ‚è¿˜æ²¡æœ‰è¢«ä¸²å£å‘é€å‡ºå»ï¼Œéœ€è¦å¼€å¯ TC ä¸­æ–­ä»¥ç¡®ä¿æœ€åä¸€å­—èŠ‚æ•°æ®è¢«ä¸²å£å‘é€å®Œæˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 void LPUART1_SendArrayIT(uint8_t *parr, uint8_t len); void LPUART1_SendArrayIT(uint8_t *parr, uint8_t len) { while (Lpuart1ITModel.txBusy == 1); // waiting last transmit Lpuart1ITModel.txBusy = 1; Lpuart1ITModel._tx_data_index = 0; Lpuart1ITModel.txLen = len; memcpy(Lpuart1ITModel.txData, parr, len); LL_LPUART_EnableIT_TXE(LPUART1); // enable tdr empty it } ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆTXï¼‰ å½“ æ”¶åˆ° 0xff æˆ–æ¥æ”¶ç¼“å†²åŒºæ»¡ æ—¶ï¼Œäº§ç”Ÿæ•°æ®å¸§æ¥æ”¶å®Œæˆæ ‡å¿—ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /** * @brief This function handles LPUART1 global interrupt. */ void LPUART1_IRQHandler(void) { /* USER CODE BEGIN LPUART1_IRQn 0 */ if ((LL_LPUART_IsEnabledIT_TXE(LPUART1) == 1) \u0026\u0026 (LL_LPUART_IsActiveFlag_TXE(LPUART1) == 1)) // TDR å‘é€å¯„å­˜å™¨ç©º å¯ä»¥æ”¾å…¥æ•°æ®å‘é€ å†™DRå¯„å­˜å™¨å³æ¸…ç©ºæ ‡å¿—ä½ { if (Lpuart1ITModel._tx_data_index == Lpuart1ITModel.txLen - 1) { LL_LPUART_DisableIT_TXE(LPUART1); // å…³é—­å‘é€å¯„å­˜å™¨ç©ºä¸­æ–­ LL_LPUART_EnableIT_TC(LPUART1); // ä½¿èƒ½å‘é€å®Œæˆä¸­æ–­ } LL_LPUART_TransmitData8(LPUART1, Lpuart1ITModel.txData[Lpuart1ITModel._tx_data_index++]); // å†™å¯„å­˜å™¨ } if ((LL_LPUART_IsEnabledIT_TC(LPUART1) == 1) \u0026\u0026 (LL_LPUART_IsActiveFlag_TC(LPUART1) == 1)) { LL_LPUART_ClearFlag_TC(LPUART1); /* Clear TC flag */ Lpuart1ITModel.txBusy = 0; } /* USER CODE END LPUART1_IRQn 0 */ /* USER CODE BEGIN LPUART1_IRQn 1 */ /* USER CODE END LPUART1_IRQn 1 */ } main ä»¥å›ç¯åº”ç”¨ä¸ºä¾‹ï¼Œå°†ä¸²å£æ¥æ”¶ç¼“å†²åŒºçš„æ•°æ®å‘é€å‡ºå»ï¼š\n1 LPUART1_SendArrayIT(Lpuart1ITModel.rxData, Lpuart1ITModel.rxLen); DMA æ–¹å¼ å€ŸåŠ© DMAï¼Œå¯ä»¥ä½¿å¾—ä¸²å£è¿›è¡Œè¿ç»­é€šä¿¡ã€‚å°†ä¸²å£å¯„å­˜å™¨çš„ DMAT å’Œ DMAR ä½ ç½®1å¯ä»¥ä½¿ç”¨ DMA æ–¹å¼æ”¶å‘ä¸²å£æ•°æ®7ã€‚å¯¹åº”çš„åº“å‡½æ•°ä¸ºï¼š\n1 2 void LL_LPUART_EnableDMAReq_TX(USART_TypeDef *LPUARTx); /* Enable DMA Mode for transmission */ void LL_LPUART_EnableDMAReq_RX(USART_TypeDef *LPUARTx); /* Enable DMA Mode for reception */ DMA å¯„å­˜å™¨ TCIFx: channle x ä¼ è¾“å®Œæˆ HTIFx: channel x ä¼ è¾“ä¸€åŠ CNDTRx: éœ€è¦ä¼ è¾“çš„æ•°æ®æ•°é‡ï¼›åªæœ‰ DMA é€šé“ disabled æ—¶æ‰å¯ä»¥å†™å…¥æ•°æ®ï¼›å½“å¯¹åº”é€šé“è¢«å¯ç”¨æ—¶ï¼Œè¯¥å¯„å­˜å™¨å˜æˆåªè¯»ï¼Œè¡¨ç¤ºå¾…ä¼ è¾“æ•°æ®çš„å‰©ä½™ä¸ªæ•°ã€‚æ¯æ¬¡ DMA ä¼ è¾“åï¼Œè¯¥å¯„å­˜å™¨å€¼é€’å‡ï¼›å½“ DMA å·¥ä½œäº Normal æ¨¡å¼æ—¶ï¼Œä¼ è¾“å®Œæˆåè¯¥å¯„å­˜å™¨ä¿æŒä¸º 0ï¼›Circular æ¨¡å¼æ—¶ï¼Œè¯¥å¯„å­˜å™¨åœ¨ä¼ è¾“å®Œæˆåè‡ªåŠ¨é‡ç½®ä¸ºä¸Šæ¬¡è®¾ç½®çš„å€¼ã€‚ å‘é€æµç¨‹ ä½¿ç”¨ DMA å‘é€ä¸²å£æ•°æ®çš„è¿‡ç¨‹ï¼šå½“ä¸²å£çš„ TXE è¢«ç½®1æ—¶ï¼ŒDMA å°†æ•°æ®ä» SRAM åŠ è½½åˆ° TDR å¯„å­˜å™¨ã€‚å…¶å…·ä½“é…ç½®è¿‡ç¨‹å¦‚ä¸‹7ï¼š\né…ç½® DMA ä¼ è¾“çš„ç›®çš„åœ°å€ä¸ºTDRå¯„å­˜å™¨åœ°å€ï¼ˆæ¯æ¬¡ TXE ç½®1æ—¶æ•°æ®éƒ½ä¼šä»å­˜å‚¨åŒºåŠ è½½åˆ° TDR å¯„å­˜å™¨ä¸­ï¼‰ã€‚ é…ç½® DMA ä¼ è¾“çš„æºåœ°å€ä¸ºæ•°æ®åœ°å€ï¼ˆæ¯æ¬¡ TXE ç½®1æ—¶æ•°æ®éƒ½ä¼šä»è¯¥åœ°å€åŠ è½½åˆ° TDR å¯„å­˜å™¨ä¸­ï¼‰ã€‚ é…ç½® DMA ä¼ è¾“çš„æ€»å­—èŠ‚æ•°ï¼ˆå‘é€æ•°æ®å­—èŠ‚ä¸ªæ•°ï¼‰ã€‚ é…ç½® DMA é€šé“çš„ä¼˜å…ˆçº§ã€‚ é…ç½® DMA ä¼ è¾“å®Œæˆ/ä¸€åŠä¸­æ–­ã€‚ æ¸…é™¤ä¸²å£å¯„å­˜å™¨çš„ TC æ ‡å¿—ä½ã€‚ï¼ˆå¦‚æœä½¿èƒ½ DMA ä¼ è¾“ä¹‹å‰å°±ä½¿èƒ½äº† TC ä¸­æ–­ï¼Œåˆ™ä¼šç«‹åˆ»è¿›å…¥ä¸­æ–­ï¼›è‹¥ç­‰åˆ° DMA ä¼ è¾“å®Œæˆåå†ä½¿èƒ½ TC ä¸­æ–­ï¼Œåˆ™å¯ä»¥ä¸åœ¨è¿™ä¸€æ­¥æ¸…é™¤æ ‡å¿—ä½ã€‚ï¼‰ æ¿€æ´» DMA çš„å¯¹åº”é€šé“ã€‚ å½“ DMA ä¼ è¾“çš„æ•°æ®é‡åˆ°è¾¾è®¾å®šçš„æ•°æ®é‡æ—¶ï¼ˆæ•°æ®è¢«ä¼ é€åˆ° TDR å¯„å­˜å™¨ï¼‰ï¼Œäº§ç”Ÿä¸­æ–­ TCIFï¼Œä½†æ­¤æ—¶æœ€åä¸€ä¸ªæ•°æ®ä»æœªè¢«ä¸²å£å‘é€å®Œæˆï¼›è‹¥è¦ç¦æ­¢ UART æˆ–è¿›å…¥åœæ­¢æ¨¡å¼å‰åº”ç›‘è§†ä¸²å£çš„ TC æ ‡å¿—ä½ä»¥ç¡®ä¿ UART é€šä¿¡æ“ä½œå·²ç»å®Œæˆã€‚\næ¥æ”¶æµç¨‹ ä½¿ç”¨ DMA æ¥æ”¶ä¸²å£æ•°æ®çš„è¿‡ç¨‹ï¼šå½“ä¸²å£çš„ RXNE è¢«ç½®1æ—¶ï¼ŒDMA å°†æ•°æ®ä» RDR å¯„å­˜å™¨åŠ è½½åˆ° SRAMã€‚å…¶å…·ä½“é…ç½®ä¸å‘é€è¿‡ç¨‹ç±»ä¼¼7ã€‚\nCubeMX é…ç½® DMA Settings ä¸­æ·»åŠ  TX å’Œ RXï¼›TX çš„ Mode é€‰æ‹© Normalï¼Œå³å‘é€ä¸€æ¬¡è‡ªåŠ¨åœæ­¢ï¼Œéœ€è¦é‡æ–°é…ç½®æ•°æ®åœ°å€ä¸é•¿åº¦ï¼›RX çš„ Mode é€‰æ‹© Circularï¼Œè¿ç»­æ¥æ”¶ã€‚\nå‹¾é€‰ NVIC Settings ä¸­çš„ global interruptã€‚\nè°ƒæ•´ Project Manager ä¸­ Advanced Settingsï¼Œç§»åŠ¨åˆå§‹åŒ–å‡½æ•°çš„è°ƒç”¨é¡ºåºï¼Œç¡®ä¿ MX_DMA_Init åœ¨ MX_xxx_UART_Init ä¹‹å‰ï¼Œå¦åˆ™æ— æ³•è¿›å…¥ DMA ä¼ è¾“è¿‡ç¨‹8ã€‚\nä»£ç  å‚è€ƒï¼šUSART_Communication_TxRx_DMA9ã€ä¸€ä¸ªä¸¥è°¨çš„STM32ä¸²å£DMAå‘é€\u0026æ¥æ”¶ï¼ˆ1.5Mbpsæ³¢ç‰¹ç‡ï¼‰æœºåˆ¶10ã€usart_rx_idle_line_irq_L411\nå®šé•¿æ¥æ”¶ è‹¥è¦åœ¨ DMA ä¸æ”¯æŒåŒç¼“å†²çš„æƒ…å†µä¸‹å®ç°æ•°æ®åŒç¼“å†²å®šé•¿æ¥æ”¶ï¼Œå¯ä»¥ç»“åˆ DMA çš„ HT ä¸­æ–­å®ç°ï¼Œæ­¤æ—¶ç»“æ„ä½“ä¸­çš„ rxData ï¼ˆDMA æ¥æ”¶ç¼“å†²åŒºï¼‰æ•°ç»„é•¿åº¦åº”ä¸ºæ•°æ®é•¿åº¦çš„ä¸€åŠï¼Œé˜²æ­¢å¤„ç†æ•°æ®ä¸åŠæ—¶ä¸€äº›æ•°æ®è¢«ä¸‹ä¸€æ¬¡ DMA ä¼ è¾“è¦†ç›–ã€‚\nå®šä¹‰ç»“æ„ä½“ UartDMAFixModel 1 2 3 4 5 6 7 8 9 10 typedef struct { volatile uint8_t rxFlag; // æ¥æ”¶å®Œä¸€å¸§æ•°æ®æ ‡å¿—ä½ 1: æ¥æ”¶å®Œæˆ uint8_t rxLen; // å®šé•¿æ•°æ®å¸§é•¿åº¦, _rx_dma_data çš„ä¸€åŠ uint8_t _rx_dma_data[20]; // DMA æ¥æ”¶æ•°æ®ç¼“å†²åŒºï¼Œå®šé•¿æ¥æ”¶æ¯æ¬¡åªå¤„ç†ä¸€åŠæ•°æ® uint8_t *rxDataPointer; // æŒ‡å‘å½“å‰å¯ä»¥å¤„ç†çš„æ•°æ®çš„é¦–åœ°å€, åœ¨ DMA ä¸­æ–­åˆ‡æ¢åœ°å€ volatile uint8_t txBusy; // 0: ä¸²å£æ²¡æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€; 1: æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€ uint8_t txData[10]; // éœ€è¦å‘é€çš„æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ DMA å‘é€çš„ç¼“å†²åŒº } UartDMAFixModel_1010; 1 2 3 4 5 6 7 8 9 10 UartDMAFixModel_1010 Lpuart1DMAFixModel = { .rxFlag = 0, .rxLen = sizeof(Lpuart1DMAFixModel._rx_dma_data) / 2, ._rx_dma_data = {0}, .rxDataPointer = NULL, .txBusy = 0, .txData = {0} }; 1 extern UartDMAFixModel_1010 Lpuart1DMAFixModel; é…ç½®ä¸²å£ DMA åœ°å€ã€é•¿åº¦ã€ä¸­æ–­ CubeMX ç”Ÿæˆçš„ä»£ç å¹¶ä¸ä¼šé…ç½® DMA çš„å¤–è®¾å’Œå­˜å‚¨å™¨åœ°å€ã€æ•°æ®é•¿åº¦ä»¥åŠç›¸åº”çš„ä¼ è¾“ä¸­æ–­ï¼›ç¼–å†™å¹¶è°ƒç”¨ä¸‹åˆ—ä»£ç ä»¥è®¾å®šä¸²å£ TX å’Œ RX çš„ DMA ç›¸åº”é…ç½®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 /** * @brief extra config LPUART1 TX RX Variable length data reception use DMA * @param None * @retval None */ void LPUART1_DMAFixConfig(void) { LL_DMA_SetPeriphAddress(DMA2, LL_DMA_CHANNEL_6, LL_LPUART_DMA_GetRegAddr(LPUART1, LL_LPUART_DMA_REG_DATA_TRANSMIT)); // tx dma dest address LL_DMA_EnableIT_TC(DMA2, LL_DMA_CHANNEL_6); // tx dma transfer complete interrupt // rx dma source address and dest address and length LL_DMA_SetPeriphAddress(DMA2, LL_DMA_CHANNEL_7, LL_LPUART_DMA_GetRegAddr(LPUART1, LL_LPUART_DMA_REG_DATA_RECEIVE)); LL_DMA_SetMemoryAddress(DMA2, LL_DMA_CHANNEL_7, (uint32_t)Lpuart1DMAFixModel._rx_dma_data); LL_DMA_SetDataLength(DMA2, LL_DMA_CHANNEL_7, sizeof(Lpuart1DMAFixModel._rx_dma_data)); LL_DMA_EnableIT_TC(DMA2, LL_DMA_CHANNEL_7); // rx dma transfer complete interrupt LL_DMA_EnableIT_HT(DMA2, LL_DMA_CHANNEL_7); // rx dma half transfer interrupt LL_DMA_EnableChannel(DMA2, LL_DMA_CHANNEL_7); // enable uart dma rx LL_LPUART_EnableDMAReq_TX(LPUART1); // enable dma to handle uart tdr LL_LPUART_EnableDMAReq_RX(LPUART1); // enable dma to handle uart rdr } DMA ä¸­æ–­å‡½æ•°ï¼ˆHT TCï¼‰ ä½¿ç”¨ DMA çš„ä¼ è¾“å®Œæˆä¸­æ–­å’Œä¼ è¾“åŠå®Œæˆä¸­æ–­å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œä¸²å£æ•°æ®çš„å®šé•¿æ¥æ”¶ï¼›æ ¹æ®ä¸åŒçš„ DMA æ ‡å¿—ä½è®¾å®šæŒ‡å‘å½“å‰å¯ä»¥å¤„ç†çš„æ•°æ®çš„é¦–åœ°å€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 /** * @brief This function handles DMA2 channel7 global interrupt. */ void DMA2_Channel7_IRQHandler(void) { /* USER CODE BEGIN DMA2_Channel7_IRQn 0 */ // lpuart1 rx if (LL_DMA_IsEnabledIT_HT(DMA2, LL_DMA_CHANNEL_7) \u0026\u0026 LL_DMA_IsActiveFlag_HT7(DMA2)) { LL_DMA_ClearFlag_HT7(DMA2); // TODO: uart rx dma half transfer Lpuart1DMAFixModel.rxDataPointer = Lpuart1DMAFixModel._rx_dma_data + 0; Lpuart1DMAFixModel.rxFlag = 1; } if (LL_DMA_IsEnabledIT_TC(DMA2, LL_DMA_CHANNEL_7) \u0026\u0026 LL_DMA_IsActiveFlag_TC7(DMA2)) { LL_DMA_ClearFlag_TC7(DMA2); // TODO: uart rx dma transfer complete Lpuart1DMAFixModel.rxDataPointer = Lpuart1DMAFixModel._rx_dma_data + Lpuart1DMAFixModel.rxLen; Lpuart1DMAFixModel.rxFlag = 1; } /* USER CODE END DMA2_Channel7_IRQn 0 */ /* USER CODE BEGIN DMA2_Channel7_IRQn 1 */ /* USER CODE END DMA2_Channel7_IRQn 1 */ } é‡ç½® DMA æ¥æ”¶é•¿åº¦ å¯¹äºå®šé•¿æ•°æ®çš„æ¥æ”¶ï¼Œæ•°æ®æ¥æ”¶å®Œæˆæ˜¯é  DMA çš„ä¼ è¾“ä¸€åŠæˆ–ä¼ è¾“å®Œæˆæ ‡å¿—ä½åˆ¤æ–­çš„ï¼›è‹¥æŸæ¬¡é€šä¿¡æ—¶ï¼Œæ•°æ®å¸§çš„ä¸€ä¸ªå­—èŠ‚ä¸¢å¤±ï¼Œåˆ™ä¼šå¯¼è‡´åç»­çš„æ•°æ®å…¨éƒ¨é”™ä½ï¼Œä»è€Œæ— æ³•æ­£ç¡®è§£æã€‚å› æ­¤åœ¨æ•°æ®å¤„ç†ä¹‹å‰éœ€è¦é€šè¿‡æ ¡éªŒå¸§å¤´æˆ–è€…æ ¡éªŒå’Œç­‰æ–¹å¼åˆ¤æ–­æ•°æ®æ˜¯å¦æœ‰æ•ˆï¼›å½“å‰æ•°æ®å¸§é”™è¯¯æ—¶ï¼Œå¯¹äºä¸‹ä¸€å¸§æ•°æ®åº”é‡æ–°ä» DMA æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æ¥æ”¶ã€‚\nä¸‹é¢å‡è®¾æ•°æ®å¸§å¤´å¿…é¡»ä¸º 0x55ï¼Œæ ¡éªŒæˆåŠŸæ—¶ï¼Œå°†æ”¶åˆ°çš„ä¸€å¸§æ•°æ®é€šè¿‡ä¸²å£å‘å›ï¼›å½“æ•°æ®å¸§æ ¡éªŒå¤±è´¥æ—¶ï¼Œå…³é—­ DMA æ¥æ”¶é€šé“å¹¶é‡ç½® DMA æ¥æ”¶æ•°æ®é•¿åº¦ï¼ŒåŒæ—¶æ‰“å¼€ä¸²å£ç©ºé—²ä¸­æ–­ï¼Œç­‰å¾…å½“å‰æ•°æ®å¸§å…¨éƒ¨å‘é€å®Œæˆåé‡æ–°æ‰“å¼€ DMA æ¥æ”¶é€šé“ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 /** * @brief Verify data frames and parse data * @param pdata pointer to the first data * @retval 1: verify success; 0: verify fail */ uint8_t Lpurat1DataProcess(uint8_t *pdata) { uint8_t dataValid = 0; // Verify data frame if (pdata[0] != 0x55) // example: frame header must be 0x55 { dataValid = 0; } else { dataValid = 1; } if (dataValid == 0) { // The data may be misaligned // reset dma rx length // 1st: disable dma rx channel LL_DMA_DisableChannel(DMA2, LL_DMA_CHANNEL_7); // 2nd: reset data length so that new transfer can be placed into the first array element LL_DMA_SetDataLength(DMA2, LL_DMA_CHANNEL_7, sizeof(Lpuart1DMAFixModel._rx_dma_data)); // 3rd: enable uart rx idle it, When the current full data frame transmission is complete, re-enable DMA reception. LL_LPUART_EnableIT_IDLE(LPUART1); // 4th: (in the function UART IRQHandler) return 0; } // TODO: data parsing LPUART1_SendArrayDMA(pdata, Lpuart1DMAFixModel.rxLen); // ... return 1; } ä¸²å£ç©ºé—²ä¸­æ–­å¤„ç†è¿‡ç¨‹ï¼šæ¸…é™¤ç©ºé—²æ ‡å¿—ä½ã€å…³é—­ä¸²å£ç©ºé—²ä¸­æ–­ã€é‡æ–°å¼€å¯ DMA æ¥æ”¶é€šé“ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 /** * @brief This function handles LPUART1 global interrupt. */ void LPUART1_IRQHandler(void) { /* USER CODE BEGIN LPUART1_IRQn 0 */ if ((LL_LPUART_IsEnabledIT_IDLE(LPUART1) == 1) \u0026\u0026 (LL_LPUART_IsActiveFlag_IDLE(LPUART1) == 1)) { LL_LPUART_ClearFlag_IDLE(LPUART1); // 1st-3rd: (in the function Lpurat1DataProcess()) // 4th: disable idle it and re-enable DMA reception. LL_LPUART_DisableIT_IDLE(LPUART1); LL_DMA_EnableChannel(DMA2, LL_DMA_CHANNEL_7); } /* USER CODE END LPUART1_IRQn 0 */ /* USER CODE BEGIN LPUART1_IRQn 1 */ /* USER CODE END LPUART1_IRQn 1 */ } main æ”¶åˆ°æ•°æ®åï¼Œè°ƒç”¨æ•°æ®å¤„ç†å‡½æ•°ã€‚\n1 2 3 4 5 6 7 8 9 10 if (Lpuart1DMAFixModel.rxFlag == 1) // HT or TC { uint8_t verifyResult = Lpurat1DataProcess(Lpuart1DMAFixModel.rxDataPointer); if (verifyResult == 0) { // TODO: check verifyResult // ... } Lpuart1DMAFixModel.rxFlag = 0; } ä¸å®šé•¿æ¥æ”¶ å®šä¹‰ç»“æ„ä½“ UartDMAVarModel ç»“æ„ä½“ä¸­çš„ rxData æœ€å¥½æ¯”æœ€é•¿çš„æ•°æ®å¸§å¤šå‡ ä¸ªå­—èŠ‚ï¼Œé˜²æ­¢å¤„ç†æ•°æ®ä¸åŠæ—¶ä¸€äº›æ•°æ®è¢«ä¸‹ä¸€æ¬¡ DMA ä¼ è¾“è¦†ç›–ã€‚\n1 2 3 4 5 6 7 8 9 10 11 typedef struct { volatile uint8_t rxFlag; // æ¥æ”¶å®Œä¸€å¸§æ•°æ®æ ‡å¿—ä½ uint8_t rxLen; // å½“å‰æ•°æ®å¸§é•¿åº¦ uint8_t rxData[10]; // å½“å‰æ•°æ® uint8_t _rx_dma_data[10]; // DMA æ¥æ”¶ç¼“å†²åŒº uint8_t _rx_dma_last_used; // ä¸Šä¸€å¸§æ•°æ®ä¼ è¾“å®Œæˆæ—¶DMAçš„ä½¿ç”¨é‡ volatile uint8_t txBusy; // 0: ä¸²å£æ²¡æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€; 1: æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€ uint8_t txData[10]; // éœ€è¦å‘é€çš„æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ DMA å‘é€çš„ç¼“å†²åŒº } UartDMAVarModel_1010; 1 UartDMAVarModel_1010 Lpuart1DMAVarModel = {0}; 1 extern UartDMAVarModel_1010 Lpuart1DMAVarModel; é…ç½®ä¸²å£ DMA åœ°å€ã€é•¿åº¦ã€ä¸­æ–­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 void LPUART1_DMAVarConfig(void); /** * @brief extra config LPUART1 TX RX use DMA * @param None * @retval None */ void LPUART1_DMAVarConfig(void) { // tx dma dest address LL_DMA_SetPeriphAddress(DMA2, LL_DMA_CHANNEL_6, LL_LPUART_DMA_GetRegAddr(LPUART1, LL_LPUART_DMA_REG_DATA_TRANSMIT)); // enable dma tx transfer complete interrupt LL_DMA_EnableIT_TC(DMA2, LL_DMA_CHANNEL_6); // rx dma source address and dest address and length LL_DMA_SetPeriphAddress(DMA2, LL_DMA_CHANNEL_7, LL_LPUART_DMA_GetRegAddr(LPUART1, LL_LPUART_DMA_REG_DATA_RECEIVE)); LL_DMA_SetMemoryAddress(DMA2, LL_DMA_CHANNEL_7, (uint32_t)Lpuart1DMAVarModel._rx_dma_data); LL_DMA_SetDataLength(DMA2, LL_DMA_CHANNEL_7, sizeof(Lpuart1DMAVarModel._rx_dma_data)); // no need to enable dma rx tc and ht interrupt // enable uart dma rx LL_DMA_EnableChannel(DMA2, LL_DMA_CHANNEL_7); // enable uart idle interrupt LL_LPUART_ClearFlag_IDLE(LPUART1); LL_LPUART_EnableIT_IDLE(LPUART1); LL_LPUART_EnableDMAReq_TX(LPUART1); // enable dma to handle uart tdr LL_LPUART_EnableDMAReq_RX(LPUART1); // enable dma to handle uart rdr } ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆIDLE ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 /** * @brief This function handles LPUART1 global interrupt. */ void LPUART1_IRQHandler(void) { /* USER CODE BEGIN LPUART1_IRQn 0 */ if ((LL_LPUART_IsEnabledIT_IDLE(LPUART1) == 1) \u0026\u0026 (LL_LPUART_IsActiveFlag_IDLE(LPUART1) == 1)) { LL_LPUART_ClearFlag_IDLE(LPUART1); uint8_t dmaTransedLen = sizeof(Lpuart1DMAVarModel._rx_dma_data) - LL_DMA_GetDataLength(DMA2, LL_DMA_CHANNEL_7); // å½“å‰ DMA å·²ä¼ è¾“æ•°é‡ if (dmaTransedLen \u003e Lpuart1DMAVarModel._rx_dma_last_used) // æœ¬æ¬¡æ•°æ®å¸§ä¼ è¾“è·¨è¿‡äº† DMA æ•°ç»„æœ«å°¾ { /* * Processing is done in \"linear\" mode. * * Application processing is fast with single data block, * length is simply calculated by subtracting pointers * * [ 0 ] * [ 1 ] \u003c- _rx_dma_last_used |-----------------------------------------| * [ 2 ] | Single block | * [ 3 ] | len = dmaTransedLen - _rx_dma_last_used | * [ 4 ] | | * [ 5 ] |-----------------------------------------| * [ 6 ] \u003c- dmaTransedLen * [ 7 ] * [N - 1] */ // æœ¬æ¬¡ä¼ è¾“é‡ = å½“å‰DMAå·²ä¼ è¾“é‡ - ä¸Šæ¬¡ä¼ è¾“åå‰©ä½™çš„DMAæ•°é‡ Lpuart1DMAVarModel.rxLen = dmaTransedLen - Lpuart1DMAVarModel._rx_dma_last_used; // æ‹·è´ DMA æ•°æ® memcpy(Lpuart1DMAVarModel.rxData, Lpuart1DMAVarModel._rx_dma_data + Lpuart1DMAVarModel._rx_dma_last_used, Lpuart1DMAVarModel.rxLen); } else { /* * Processing is done in \"overflow\" mode.. * * Application must process data twice, * since there are 2 linear memory blocks to handle * * [ 0 ] |------------------------------------| * [ 1 ] | 2nd block (len = dmaTransedLen) | * [ 2 ] |------------------------------------| * [ 3 ] \u003c- dmaTransedLen * [ 4 ] \u003c- _rx_dma_last_used |------------------------------------| * [ 5 ] | 1st block | * [ 6 ] | len = N - _rx_dma_last_used | * [ 7 ] | | * [N - 1] |------------------------------------| */ // æœ¬æ¬¡ä¼ è¾“é‡ = ä¸Šæ¬¡ä¼ è¾“åå‰©ä½™çš„DMAæ•°é‡ + å½“å‰DMAå·²ä¼ è¾“é‡ Lpuart1DMAVarModel.rxLen = (sizeof(Lpuart1DMAVarModel._rx_dma_data) - Lpuart1DMAVarModel._rx_dma_last_used) + dmaTransedLen; // å…ˆæ‹·è´ä¸Šæ¬¡ä¼ è¾“åå‰©ä½™çš„ DMA æ•°ç»„ rxData \u003c- _rx_dma_data[_rx_dma_last_used] memcpy(Lpuart1DMAVarModel.rxData, Lpuart1DMAVarModel._rx_dma_data + Lpuart1DMAVarModel._rx_dma_last_used/* base */, sizeof(Lpuart1DMAVarModel._rx_dma_data) - Lpuart1DMAVarModel._rx_dma_last_used ); // å†æ‹·è´æœ¬æ¬¡ DMA ä¼ è¾“çš„ç”¨é‡ memcpy(Lpuart1DMAVarModel.rxData + (sizeof(Lpuart1DMAVarModel._rx_dma_data) - Lpuart1DMAVarModel._rx_dma_last_used), Lpuart1DMAVarModel._rx_dma_data, dmaTransedLen ); } Lpuart1DMAVarModel._rx_dma_last_used = dmaTransedLen; Lpuart1DMAVarModel.rxFlag = 1; } /* USER CODE END LPUART1_IRQn 0 */ /* USER CODE BEGIN LPUART1_IRQn 1 */ /* USER CODE END LPUART1_IRQn 1 */ } main ä»¥å›ç¯åº”ç”¨ä¸ºä¾‹ï¼Œå½“æ¥æ”¶åˆ°ä¸€å¸§æ•°æ®åæŠŠæ•°æ®å‘å›ã€‚\n1 2 3 4 5 if (Lpuart1DMAVarModel.rxFlag == 1) { LPUART1_SendArrayDMA(Lpuart1DMAVarModel.rxData, Lpuart1DMAVarModel.rxLen); Lpuart1DMAVarModel.rxFlag = 0; } å‘é€ ä¸‹é¢ä»¥å®šé•¿æ¥æ”¶çš„ç»“æ„ä½“ä¸ºä¾‹ï¼Œç»™å‡ºä½¿ç”¨ DMA è¿›è¡Œä¸²å£æ•°æ®å‘é€çš„ä»£ç ã€‚DMA çš„åˆå§‹åŒ–è¿‡ç¨‹å·²ç»åœ¨æ¥æ”¶çš„é…ç½®ä¸­é¡ºä¾¿é…ç½®è¿‡äº†ã€‚\nå‘é€æ•°æ® 1 2 3 4 5 6 7 8 9 10 11 12 13 void LPUART1_SendArrayDMA(uint8_t *parr, uint8_t len); void LPUART1_SendArrayDMA(uint8_t *parr, uint8_t len) { while (Lpuart1DMAVarModel.txBusy == 1); // wait last data transfer complete Lpuart1DMAVarModel.txBusy = 0; memcpy(Lpuart1DMAVarModel.txData, parr, len); LL_DMA_SetMemoryAddress(DMA2, LL_DMA_CHANNEL_6, (uint32_t)Lpuart1DMAVarModel.txData); // tx dma mem address LL_DMA_SetDataLength(DMA2, LL_DMA_CHANNEL_6, len); // tx dma length LL_DMA_EnableChannel(DMA2, LL_DMA_CHANNEL_6); } DMA ä¸­æ–­å‡½æ•°ï¼ˆTCï¼‰ DMA çš„ä¼ è¾“å®Œæˆä¸­æ–­ TC åªèƒ½ä»£è¡¨æŠŠæ‰€æœ‰å¾…å‘é€çš„æ•°æ®éƒ½ä¼ è¾“åˆ°äº†ä¸²å£çš„ TDR å¯„å­˜å™¨ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶æœ€åä¸€å­—èŠ‚æ•°æ®å¹¶æ²¡æœ‰è¢«ä¸²å£å‘é€å®Œæˆï¼›åº”å¼€å¯ä¸²å£å‘é€å®Œæˆä¸­æ–­åˆ¤æ–­æ•°æ®å…¨éƒ¨å‘é€å®Œæˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 /** * @brief This function handles DMA2 channel6 global interrupt. */ void DMA2_Channel6_IRQHandler(void) { /* USER CODE BEGIN DMA2_Channel6_IRQn 0 */ // lpuart1 tx if(LL_DMA_IsEnabledIT_TC(DMA2, LL_DMA_CHANNEL_6) \u0026\u0026 LL_DMA_IsActiveFlag_TC6(DMA2)) { LL_DMA_ClearFlag_TC6(DMA2); LL_DMA_DisableChannel(DMA2, LL_DMA_CHANNEL_6); LL_LPUART_EnableIT_TC(LPUART1); } /* USER CODE END DMA2_Channel6_IRQn 0 */ /* USER CODE BEGIN DMA2_Channel6_IRQn 1 */ /* USER CODE END DMA2_Channel6_IRQn 1 */ } ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆTCï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 /** * @brief This function handles LPUART1 global interrupt. */ void LPUART1_IRQHandler(void) { /* USER CODE BEGIN LPUART1_IRQn 0 */ if ((LL_LPUART_IsEnabledIT_TC(LPUART1) == 1) \u0026\u0026 (LL_LPUART_IsActiveFlag_TC(LPUART1) == 1)) { LL_LPUART_ClearFlag_TC(LPUART1); /* Clear TC flag */ Lpuart1DMAVarModel.txBusy = 0; } /* USER CODE END LPUART1_IRQn 0 */ /* USER CODE BEGIN LPUART1_IRQn 1 */ /* USER CODE END LPUART1_IRQn 1 */ } References RM0090_STM32F405415,407417,427437,429439_ReferenceManual | 30.3 USART functional description | p.968Â â†©ï¸\nRM0351 Reference manual STM32L47xxx, STM32L48xxx, STM32L49xxx and STM32L4Axxx advanced ArmÂ®-based 32-bit MCUs | 40.5.1 USART character description | p.1344-1345Â â†©ï¸\nRM0351 Reference manual STM32L47xxx, STM32L48xxx, STM32L49xxx and STM32L4Axxx advanced ArmÂ®-based 32-bit MCUs | 40.5.3 USART receiver | p.1350Â â†©ï¸\nRM0351 Reference manual STM32L47xxx, STM32L48xxx, STM32L49xxx and STM32L4Axxx advanced ArmÂ®-based 32-bit MCUs | 41.4.4 LPUART baud rate generation | p.1419Â â†©ï¸\nSTM32Cube_FW_L4_V1.17.0\\Projects\\NUCLEO-L496ZG\\Examples_LL\\USART\\USART_Communication_Rx_ITÂ â†©ï¸\nSTM32Cube_FW_L4_V1.17.0\\Projects\\NUCLEO-L496ZG\\Examples_LL\\USART\\USART_Communication_Tx_ITÂ â†©ï¸\nRM0351 Reference manual STM32L47xxx, STM32L48xxx, STM32L49xxx and STM32L4Axxx advanced ArmÂ®-based 32-bit MCUs | 41.4.9 Continuous communication in DMA mode using LPUART | p.1425Â â†©ï¸Â â†©ï¸Â â†©ï¸\nCUBEMXç”Ÿæˆä»£ç éœ€è¦æ³¨æ„é¡ºåºï¼ŒæŠ˜è…¾STM32+ADC+DMA | CSDN | ricefat609Â â†©ï¸\nSTM32Cube_FW_L4_V1.17.0\\Projects\\NUCLEO-L496ZG\\Examples_LL\\USART\\USART_Communication_TxRx_DMAÂ â†©ï¸\nä¸€ä¸ªä¸¥è°¨çš„STM32ä¸²å£DMAå‘é€\u0026æ¥æ”¶ï¼ˆ1.5Mbpsæ³¢ç‰¹ç‡ï¼‰æœºåˆ¶ | CSDN | Acuity.Â â†©ï¸\nusart_rx_idle_line_irq_L4 | Github | MaJerleÂ â†©ï¸\n",
  "wordCount" : "5256",
  "inLanguage": "zh-cn",
  "datePublished": "2023-02-02T17:08:13+08:00",
  "dateModified": "2023-02-25T17:27:00+08:00",
  "author":{
    "@type": "Person",
    "name": "hey"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fivekernels.github.io/posts/stm32-uart-ll/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "èƒ¡å†™ä¹±ç”»",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fivekernels.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://fivekernels.github.io/" accesskey="h" title="èƒ¡å†™ä¹±ç”» (Alt + H)">èƒ¡å†™ä¹±ç”»</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://fivekernels.github.io/" title="ğŸ é¦–é¡µ">
                    <span>ğŸ é¦–é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://fivekernels.github.io/posts/" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://fivekernels.github.io/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://fivekernels.github.io/categories/" title="ğŸ§©åˆ†ç±»">
                    <span>ğŸ§©åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://fivekernels.github.io/tags/" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://fivekernels.github.io/about/" title="ğŸ¥£å…³äº">
                    <span>ğŸ¥£å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://fivekernels.github.io/search/" title="ğŸ”æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://fivekernels.github.io/">Home</a>&nbsp;Â»&nbsp;<a href="https://fivekernels.github.io/posts/">ğŸ“šæ–‡ç« </a></div>
    <h1 class="post-title">
      STM32 UART LL Library
    </h1>
    <div class="post-meta">



<span title='2023-02-02 17:08:13 +0800 CST'>2023/02/02</span>&nbsp;Â·&nbsp;Updated:&nbsp;2023/02/25&nbsp;Â·&nbsp;11 min&nbsp;Â·&nbsp;5256 words&nbsp;Â·&nbsp;hey

</div>
  </header> 
  <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#uart-%e6%a1%86%e5%9b%be" aria-label="UART æ¡†å›¾">UART æ¡†å›¾</a></li>
                    <li>
                        <a href="#uart-%e5%af%84%e5%ad%98%e5%99%a8" aria-label="UART å¯„å­˜å™¨">UART å¯„å­˜å™¨</a></li>
                    <li>
                        <a href="#%e4%bd%8e%e5%8a%9f%e8%80%97%e4%b8%b2%e5%8f%a3%e7%9a%84%e6%97%b6%e9%92%9f%e5%92%8c%e6%b3%a2%e7%89%b9%e7%8e%87" aria-label="ä½åŠŸè€—ä¸²å£çš„æ—¶é’Ÿå’Œæ³¢ç‰¹ç‡">ä½åŠŸè€—ä¸²å£çš„æ—¶é’Ÿå’Œæ³¢ç‰¹ç‡</a></li>
                    <li>
                        <a href="#%e4%b8%ad%e6%96%ad%e6%96%b9%e5%bc%8f" aria-label="ä¸­æ–­æ–¹å¼">ä¸­æ–­æ–¹å¼</a><ul>
                            
                    <li>
                        <a href="#cubemx-%e9%85%8d%e7%bd%ae" aria-label="CubeMX é…ç½®">CubeMX é…ç½®</a></li>
                    <li>
                        <a href="#%e4%bb%a3%e7%a0%81" aria-label="ä»£ç ">ä»£ç </a><ul>
                            
                    <li>
                        <a href="#%e5%ae%9a%e4%b9%89%e7%bb%93%e6%9e%84%e4%bd%93-uartitmodel" aria-label="å®šä¹‰ç»“æ„ä½“ UartITModel">å®šä¹‰ç»“æ„ä½“ UartITModel</a></li>
                    <li>
                        <a href="#%e9%85%8d%e7%bd%ae%e4%b8%b2%e5%8f%a3%e6%8e%a5%e6%94%b6%e4%b8%ad%e6%96%ad" aria-label="é…ç½®ä¸²å£æ¥æ”¶ä¸­æ–­">é…ç½®ä¸²å£æ¥æ”¶ä¸­æ–­</a></li>
                    <li>
                        <a href="#%e4%b8%b2%e5%8f%a3%e4%b8%ad%e6%96%ad%e5%87%bd%e6%95%b0rxne" aria-label="ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆRXNEï¼‰">ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆRXNEï¼‰</a></li>
                    <li>
                        <a href="#%e5%8f%91%e9%80%81%e6%95%b0%e6%8d%ae" aria-label="å‘é€æ•°æ®">å‘é€æ•°æ®</a></li>
                    <li>
                        <a href="#%e4%b8%b2%e5%8f%a3%e4%b8%ad%e6%96%ad%e5%87%bd%e6%95%b0tx" aria-label="ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆTXï¼‰">ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆTXï¼‰</a></li>
                    <li>
                        <a href="#main" aria-label="main">main</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#dma-%e6%96%b9%e5%bc%8f" aria-label="DMA æ–¹å¼">DMA æ–¹å¼</a><ul>
                            
                    <li>
                        <a href="#dma-%e5%af%84%e5%ad%98%e5%99%a8" aria-label="DMA å¯„å­˜å™¨">DMA å¯„å­˜å™¨</a></li>
                    <li>
                        <a href="#%e5%8f%91%e9%80%81%e6%b5%81%e7%a8%8b" aria-label="å‘é€æµç¨‹">å‘é€æµç¨‹</a></li>
                    <li>
                        <a href="#%e6%8e%a5%e6%94%b6%e6%b5%81%e7%a8%8b" aria-label="æ¥æ”¶æµç¨‹">æ¥æ”¶æµç¨‹</a></li>
                    <li>
                        <a href="#cubemx-%e9%85%8d%e7%bd%ae-1" aria-label="CubeMX é…ç½®">CubeMX é…ç½®</a></li>
                    <li>
                        <a href="#%e4%bb%a3%e7%a0%81-1" aria-label="ä»£ç ">ä»£ç </a><ul>
                            
                    <li>
                        <a href="#%e5%ae%9a%e9%95%bf%e6%8e%a5%e6%94%b6" aria-label="å®šé•¿æ¥æ”¶">å®šé•¿æ¥æ”¶</a><ul>
                            
                    <li>
                        <a href="#%e5%ae%9a%e4%b9%89%e7%bb%93%e6%9e%84%e4%bd%93-uartdmafixmodel" aria-label="å®šä¹‰ç»“æ„ä½“ UartDMAFixModel">å®šä¹‰ç»“æ„ä½“ UartDMAFixModel</a></li>
                    <li>
                        <a href="#%e9%85%8d%e7%bd%ae%e4%b8%b2%e5%8f%a3-dma-%e5%9c%b0%e5%9d%80%e9%95%bf%e5%ba%a6%e4%b8%ad%e6%96%ad" aria-label="é…ç½®ä¸²å£ DMA åœ°å€ã€é•¿åº¦ã€ä¸­æ–­">é…ç½®ä¸²å£ DMA åœ°å€ã€é•¿åº¦ã€ä¸­æ–­</a></li>
                    <li>
                        <a href="#dma-%e4%b8%ad%e6%96%ad%e5%87%bd%e6%95%b0ht-tc" aria-label="DMA ä¸­æ–­å‡½æ•°ï¼ˆHT TCï¼‰">DMA ä¸­æ–­å‡½æ•°ï¼ˆHT TCï¼‰</a></li>
                    <li>
                        <a href="#%e9%87%8d%e7%bd%ae-dma-%e6%8e%a5%e6%94%b6%e9%95%bf%e5%ba%a6" aria-label="é‡ç½® DMA æ¥æ”¶é•¿åº¦">é‡ç½® DMA æ¥æ”¶é•¿åº¦</a></li>
                    <li>
                        <a href="#main-1" aria-label="main">main</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%b8%8d%e5%ae%9a%e9%95%bf%e6%8e%a5%e6%94%b6" aria-label="ä¸å®šé•¿æ¥æ”¶">ä¸å®šé•¿æ¥æ”¶</a><ul>
                            
                    <li>
                        <a href="#%e5%ae%9a%e4%b9%89%e7%bb%93%e6%9e%84%e4%bd%93-uartdmavarmodel" aria-label="å®šä¹‰ç»“æ„ä½“ UartDMAVarModel">å®šä¹‰ç»“æ„ä½“ UartDMAVarModel</a></li>
                    <li>
                        <a href="#%e9%85%8d%e7%bd%ae%e4%b8%b2%e5%8f%a3-dma-%e5%9c%b0%e5%9d%80%e9%95%bf%e5%ba%a6%e4%b8%ad%e6%96%ad-1" aria-label="é…ç½®ä¸²å£ DMA åœ°å€ã€é•¿åº¦ã€ä¸­æ–­">é…ç½®ä¸²å£ DMA åœ°å€ã€é•¿åº¦ã€ä¸­æ–­</a></li>
                    <li>
                        <a href="#%e4%b8%b2%e5%8f%a3%e4%b8%ad%e6%96%ad%e5%87%bd%e6%95%b0idle-" aria-label="ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆIDLE ï¼‰">ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆIDLE ï¼‰</a></li>
                    <li>
                        <a href="#main-2" aria-label="main">main</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%8f%91%e9%80%81" aria-label="å‘é€">å‘é€</a><ul>
                            
                    <li>
                        <a href="#%e5%8f%91%e9%80%81%e6%95%b0%e6%8d%ae-1" aria-label="å‘é€æ•°æ®">å‘é€æ•°æ®</a></li>
                    <li>
                        <a href="#dma-%e4%b8%ad%e6%96%ad%e5%87%bd%e6%95%b0tc" aria-label="DMA ä¸­æ–­å‡½æ•°ï¼ˆTCï¼‰">DMA ä¸­æ–­å‡½æ•°ï¼ˆTCï¼‰</a></li>
                    <li>
                        <a href="#%e4%b8%b2%e5%8f%a3%e4%b8%ad%e6%96%ad%e5%87%bd%e6%95%b0tc" aria-label="ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆTCï¼‰">ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆTCï¼‰</a></li></ul>
                    </li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#references" aria-label="References">References</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h2 id="uart-æ¡†å›¾">UART æ¡†å›¾<a hidden class="anchor" aria-hidden="true" href="#uart-æ¡†å›¾">#</a></h2>
<p>â€ƒâ€ƒæŸ¥çœ‹èŠ¯ç‰‡å¯¹åº”çš„ Reference Manual çš„ USART/UART ç« èŠ‚å¯ä»¥æ‰¾åˆ°å…¶æ¡†å›¾ã€‚ä»¥ F4 ç³»åˆ—çš„å‚è€ƒæ‰‹å†Œä¸ºä¾‹ï¼Œå…¶æ¡†å›¾å¦‚ä¸‹<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>ï¼š</p>
<p><img loading="lazy" src="./images/f4_usart-bolck-diagrem.png" alt="f4_usart-bolck-diagrem.png"  />
</p>
<p>â€ƒâ€ƒå¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå‘é€çš„æ•°æ®ï¼Œä¾æ¬¡ç»è¿‡ <strong>TDR å¯„å­˜å™¨ -&gt; å‘é€ç§»ä½å¯„å­˜å™¨ -&gt; TX ç«¯å£</strong>ï¼›å¯¹äºæ¥æ”¶çš„æ•°æ®ï¼Œä» <strong>RX</strong> ç«¯å£ä¾æ¬¡ç»è¿‡ <strong>æ¥æ”¶ç§»ä½å¯„å­˜å™¨ -&gt; RDRå¯„å­˜å™¨</strong>ã€‚</p>
<h2 id="uart-å¯„å­˜å™¨">UART å¯„å­˜å™¨<a hidden class="anchor" aria-hidden="true" href="#uart-å¯„å­˜å™¨">#</a></h2>
<ul>
<li><strong>RXNE</strong>(Read data register not empty)ï¼šå½“æ¥æ”¶ç§»ä½å¯„å­˜å™¨ä¸­çš„<strong>æ•°æ®è¢«ä¼ é€åˆ° RDR å¯„å­˜å™¨</strong>æ—¶ï¼Œè¯¥ä½è¢«ç½®1ï¼›è‹¥æ‰“å¼€ä¸²å£æ¥æ”¶ä¸­æ–­(RXNEIE)=1æ—¶ï¼Œä¼šäº§ç”Ÿä¸­æ–­ã€‚<strong>è¯»å– RDR å¯„å­˜å™¨</strong>è¯¥ä½è‡ªåŠ¨æ¸…é›¶ã€‚</li>
<li><strong>TXE</strong>(Transmit data register empty)ï¼šå½“<strong>TDR å¯„å­˜å™¨ä¸­çš„æ•°æ®è¢«ä¼ é€åˆ°å‘é€ç§»ä½å¯„å­˜å™¨</strong>æ—¶ï¼ˆæ­¤æ—¶å¯ä»¥å‘ TDR å¯„å­˜å™¨å†™å…¥æ–°æ•°æ®å‘é€ï¼‰ï¼Œè¯¥ä½è¢«ç½®1ï¼›è‹¥æ‰“å¼€ä¸²å£å‘é€ä¸­æ–­(TXEIE=1)æ—¶ï¼Œä¼šäº§ç”Ÿä¸­æ–­ã€‚å½“<strong>å‘ TDR å¯„å­˜å™¨ä¸­å†™å…¥æ–°æ•°æ®</strong>æ—¶è¯¥ä½è‡ªåŠ¨æ¸…é›¶ã€‚</li>
<li><strong>TC</strong>(Transmission complete)ï¼šå½“<strong>ç§»ä½å¯„å­˜å™¨çš„æ•°æ®å‘é€å®Œæˆä¸” TDR å¯„å­˜å™¨ä¸ºç©ºï¼ˆæ²¡æœ‰ä¸‹ä¸€ä¸ªè¦å‘é€çš„æ•°æ®äº†ï¼‰<strong>æ—¶ï¼Œè¯¥ä½è¢«ç½®1ï¼›è‹¥æ‰“å¼€å‘é€å®Œæˆä¸­æ–­(TCIE=1)æ—¶ï¼Œä¼šäº§ç”Ÿä¸­æ–­ã€‚å½“</strong>å‘ TDR å¯„å­˜å™¨ä¸­å†™å…¥æ–°æ•°æ®</strong>æ—¶è¯¥ä½è‡ªåŠ¨æ¸…é›¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ¸…é›¶ã€‚</li>
<li><strong>IDLE</strong>(Idle line detected)ï¼šç©ºé—²ä½é’ˆå¯¹<strong>æ¥æ”¶</strong>è¿‡ç¨‹ï¼›å½“ä¸²å£æ¥æ”¶åˆ°ä¸€ä¸ªå­—èŠ‚åçš„<strong>ä¸€ä¸ªå‘¨æœŸ</strong>å†…éƒ½æ²¡æœ‰æ£€æµ‹åˆ°èµ·å§‹ä½æ—¶ï¼ˆå³æ£€æµ‹åˆ° <strong>Idle frame</strong> ï¼‰ï¼Œ IDLE è¢«ç½®1<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>ã€‚å½“ IDLE è¢«ç½®1åï¼Œåªæœ‰å†æ¬¡æ¥æ”¶åˆ°æ•°æ®åï¼ˆ RXNE ç½®1ï¼‰æ‰ä¼šæ£€æµ‹ä¸‹ä¸€æ¬¡ç©ºé—²ã€‚</li>
</ul>
<h2 id="ä½åŠŸè€—ä¸²å£çš„æ—¶é’Ÿå’Œæ³¢ç‰¹ç‡">ä½åŠŸè€—ä¸²å£çš„æ—¶é’Ÿå’Œæ³¢ç‰¹ç‡<a hidden class="anchor" aria-hidden="true" href="#ä½åŠŸè€—ä¸²å£çš„æ—¶é’Ÿå’Œæ³¢ç‰¹ç‡">#</a></h2>
<p>â€ƒâ€ƒå¯¹äºLPUARTï¼Œå…¶æ³¢ç‰¹ç‡å’Œå…¶æ—¶é’Ÿæºæœ‰éœ€è¦æ»¡è¶³ä¸€å®šå…³ç³»<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>ï¼š</p>
<p><img loading="lazy" src="./images/LPUART-baud-rate-generation.png" alt="LPUART-baud-rate-generation"  />
</p>
<p>å³LPUARTçš„æ—¶é’Ÿæºé¢‘ç‡å¿…é¡»åœ¨3å€æ³¢ç‰¹ç‡åˆ°4096å€æ³¢ç‰¹ç‡ä¹‹é—´ã€‚</p>
<p>â€ƒâ€ƒå¯¹äºCubeMXç”Ÿæˆçš„å·¥ç¨‹ï¼ŒLPUARTçš„æ—¶é’Ÿæºé»˜è®¤ä¸ºPCLK1ï¼ˆ80Mï¼ŒSTM32L4ï¼‰ï¼Œå› æ­¤å…¶å¯ä»¥æä¾›çš„æœ€ä½é¢‘ç‡ä¸º 80 * 10^6 / 4096 = 19532 bpsã€‚è‹¥è¦ä½¿ç”¨9600bpsç­‰ä½çš„æ³¢ç‰¹ç‡åˆ™åº”è¯¥é¦–å…ˆä¿®æ”¹ Clock Configuration ä¸­çš„ LPUART çš„æ—¶é’Ÿæºä¸º HSI(16M)ï¼š</p>
<p><img loading="lazy" src="./images/Lpuart_clk_hsi.png" alt="Lpuart_clk_hsi"  />
</p>
<p>â€ƒâ€ƒæ­¤æ—¶ï¼Œå…è®¸çš„æ³¢ç‰¹ç‡èŒƒå›´ä¸º3907bps~5.33Mbpsã€‚</p>
<h2 id="ä¸­æ–­æ–¹å¼">ä¸­æ–­æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#ä¸­æ–­æ–¹å¼">#</a></h2>
<h3 id="cubemx-é…ç½®">CubeMX é…ç½®<a hidden class="anchor" aria-hidden="true" href="#cubemx-é…ç½®">#</a></h3>
<p>â€ƒâ€ƒé€‰ä¸­éœ€è¦çš„ UARTï¼ŒMode é€‰æ‹© Asynchronousï¼Œå³å¼‚æ­¥é€šä¿¡æ–¹å¼ï¼›NVIC Settings ä¸­å‹¾é€‰ global interrupt å¹¶è®¾ç½®ä¼˜å…ˆçº§ã€‚é€‰æ‹©å¥½å¯¹åº”çš„ GPIO å¼•è„šåå°±å¯ä»¥ç”Ÿæˆå·¥ç¨‹äº†ã€‚</p>
<h3 id="ä»£ç ">ä»£ç <a hidden class="anchor" aria-hidden="true" href="#ä»£ç ">#</a></h3>
<blockquote>
<p>å‚è€ƒ ST å›ºä»¶åº“ä¾‹ç¨‹ <em>USART_Communication_Rx_IT<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></em>ã€<em>USART_Communication_Tx_IT<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup></em>ã€‚</p>
</blockquote>
<h4 id="å®šä¹‰ç»“æ„ä½“-uartitmodel">å®šä¹‰ç»“æ„ä½“ UartITModel<a hidden class="anchor" aria-hidden="true" href="#å®šä¹‰ç»“æ„ä½“-uartitmodel">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="n">rxFlag</span><span class="p">;</span>  <span class="c1">// æ¥æ”¶å®Œä¸€å¸§æ•°æ®æ ‡å¿—ä½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">rxLen</span><span class="p">;</span>            <span class="c1">// å½“å‰æ•°æ®å¸§é•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">rxData</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>       <span class="c1">// å½“å‰æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">_rx_data_index</span><span class="p">;</span>   <span class="c1">// ä¸‹ä¸€ä¸ªè¦æ¥æ”¶çš„å­—èŠ‚å­˜æ”¾çš„æ•°ç»„ä¸‹æ ‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="n">txBusy</span><span class="p">;</span>  <span class="c1">// 0: ä¸²å£æ²¡æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€; 1: æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">txLen</span><span class="p">;</span>            <span class="c1">// å¾…å‘é€çš„æ•°æ®æ€»é•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">txData</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>       <span class="c1">// å¾…å‘é€çš„æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">_tx_data_index</span><span class="p">;</span>   <span class="c1">// ä¸‹ä¸€ä¸ªè¦å‘é€çš„å­—èŠ‚çš„æ•°ç»„ä¸‹æ ‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">UartITModel_1010</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">UartITModel_1010</span> <span class="n">Lpuart1ITModel</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">UartITModel_1010</span> <span class="n">Lpuart1ITModel</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="é…ç½®ä¸²å£æ¥æ”¶ä¸­æ–­">é…ç½®ä¸²å£æ¥æ”¶ä¸­æ–­<a hidden class="anchor" aria-hidden="true" href="#é…ç½®ä¸²å£æ¥æ”¶ä¸­æ–­">#</a></h4>
<p>â€ƒâ€ƒç”Ÿæˆçš„ä»£ç é»˜è®¤ä¼šä½¿èƒ½ä¸²å£ä¸­æ–­ï¼Œä½†å¹¶ä¸ä¼šå¼€å¯ä¸²å£çš„å‘é€æˆ–æ¥æ”¶ç­‰ä¸­æ–­ï¼š</p>
<p><img loading="lazy" src="./images/uart_nvic.png" alt="uart_nvic"  />
</p>
<p>â€ƒâ€ƒæ·»åŠ å¹¶è°ƒç”¨ä»¥ä¸‹å‡½æ•°ä½¿èƒ½RXNEä¸­æ–­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_ITConfig</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_ITConfig</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// if (LL_LPUART_IsActiveFlag_RXNE(LPUART1) == 1) // sometimes rxne is set after initialization
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//     LL_LPUART_ReceiveData8(LPUART1); // clear rxne
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// }
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_LPUART_EnableIT_RXNE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span> <span class="cm">/* Enable RXNE interrupts */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä¸²å£ä¸­æ–­å‡½æ•°rxne">ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆRXNEï¼‰<a hidden class="anchor" aria-hidden="true" href="#ä¸²å£ä¸­æ–­å‡½æ•°rxne">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">  * @brief This function handles LPUART1 global interrupt.
</span></span></span><span class="line"><span class="cl"><span class="cm">  */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN LPUART1_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="nf">LL_USART_IsEnabledIT_RXNE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nf">LL_USART_IsActiveFlag_RXNE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="c1">// æ¥æ”¶åˆ°æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* Read Received character. RXNE flag is cleared by reading of RDR register */</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint8_t</span> <span class="n">rxdata</span> <span class="o">=</span> <span class="nf">LL_USART_ReceiveData8</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">rxData</span><span class="p">[</span><span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">_rx_data_index</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">rxdata</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// data condition or rx array full
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">((</span><span class="n">rxdata</span> <span class="o">==</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">_rx_data_index</span> <span class="o">==</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">rxData</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">rxLen</span> <span class="o">=</span> <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">_rx_data_index</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">_rx_data_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">rxFlag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END LPUART1_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN LPUART1_IRQn 1 */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END LPUART1_IRQn 1 */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å‘é€æ•°æ®">å‘é€æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#å‘é€æ•°æ®">#</a></h4>
<p>â€‚â€‚â€‚â€‚ä½¿ç”¨ä¸²å£ä¸­æ–­å‘é€æ•°æ®åªéœ€è¦å¼€å¯ TXE ä¸­æ–­ï¼Œåœ¨ä¸­æ–­ä¸­ä¾æ¬¡å°†éœ€è¦å‘é€çš„æ•°æ®å†™å…¥ TDR å¯„å­˜å™¨å³å¯ï¼›å†™å…¥æœ€åä¸€ä¸ªå­—èŠ‚åå¯ä»¥å…³é—­ TXE ä¸­æ–­ï¼›ä½†æ­¤æ—¶æœ€åä¸€ä¸ªå­—èŠ‚è¿˜æ²¡æœ‰è¢«ä¸²å£å‘é€å‡ºå»ï¼Œéœ€è¦å¼€å¯ TC ä¸­æ–­ä»¥ç¡®ä¿æœ€åä¸€å­—èŠ‚æ•°æ®è¢«ä¸²å£å‘é€å®Œæˆã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_SendArrayIT</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">parr</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_SendArrayIT</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">parr</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">txBusy</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// waiting last transmit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">txBusy</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">_tx_data_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">txLen</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">memcpy</span><span class="p">(</span><span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">txData</span><span class="p">,</span> <span class="n">parr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">LL_LPUART_EnableIT_TXE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span> <span class="c1">// enable tdr empty it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä¸²å£ä¸­æ–­å‡½æ•°tx">ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆTXï¼‰<a hidden class="anchor" aria-hidden="true" href="#ä¸²å£ä¸­æ–­å‡½æ•°tx">#</a></h4>
<p>â€ƒâ€ƒå½“ <em>æ”¶åˆ° 0xff æˆ–æ¥æ”¶ç¼“å†²åŒºæ»¡</em> æ—¶ï¼Œäº§ç”Ÿæ•°æ®å¸§æ¥æ”¶å®Œæˆæ ‡å¿—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">  * @brief This function handles LPUART1 global interrupt.
</span></span></span><span class="line"><span class="cl"><span class="cm">  */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN LPUART1_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="nf">LL_LPUART_IsEnabledIT_TXE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nf">LL_LPUART_IsActiveFlag_TXE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="c1">// TDR å‘é€å¯„å­˜å™¨ç©º å¯ä»¥æ”¾å…¥æ•°æ®å‘é€ å†™DRå¯„å­˜å™¨å³æ¸…ç©ºæ ‡å¿—ä½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">_tx_data_index</span> <span class="o">==</span> <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">txLen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nf">LL_LPUART_DisableIT_TXE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span> <span class="c1">// å…³é—­å‘é€å¯„å­˜å™¨ç©ºä¸­æ–­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">LL_LPUART_EnableIT_TC</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span>   <span class="c1">// ä½¿èƒ½å‘é€å®Œæˆä¸­æ–­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_LPUART_TransmitData8</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">,</span> <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">txData</span><span class="p">[</span><span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">_tx_data_index</span><span class="o">++</span><span class="p">]);</span> <span class="c1">// å†™å¯„å­˜å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="nf">LL_LPUART_IsEnabledIT_TC</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nf">LL_LPUART_IsActiveFlag_TC</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_LPUART_ClearFlag_TC</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span> <span class="cm">/* Clear TC flag */</span>
</span></span><span class="line"><span class="cl">        <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">txBusy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END LPUART1_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN LPUART1_IRQn 1 */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END LPUART1_IRQn 1 */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="main">main<a hidden class="anchor" aria-hidden="true" href="#main">#</a></h4>
<p>â€ƒâ€ƒä»¥å›ç¯åº”ç”¨ä¸ºä¾‹ï¼Œå°†ä¸²å£æ¥æ”¶ç¼“å†²åŒºçš„æ•°æ®å‘é€å‡ºå»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">LPUART1_SendArrayIT</span><span class="p">(</span><span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">rxData</span><span class="p">,</span> <span class="n">Lpuart1ITModel</span><span class="p">.</span><span class="n">rxLen</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="dma-æ–¹å¼">DMA æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#dma-æ–¹å¼">#</a></h2>
<p>â€ƒâ€ƒå€ŸåŠ© DMAï¼Œå¯ä»¥ä½¿å¾—ä¸²å£è¿›è¡Œè¿ç»­é€šä¿¡ã€‚å°†ä¸²å£å¯„å­˜å™¨çš„ DMAT å’Œ DMAR ä½ ç½®1å¯ä»¥ä½¿ç”¨ DMA æ–¹å¼æ”¶å‘ä¸²å£æ•°æ®<sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>ã€‚å¯¹åº”çš„åº“å‡½æ•°ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LL_LPUART_EnableDMAReq_TX</span><span class="p">(</span><span class="n">USART_TypeDef</span> <span class="o">*</span><span class="n">LPUARTx</span><span class="p">);</span> <span class="cm">/* Enable DMA Mode for transmission */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LL_LPUART_EnableDMAReq_RX</span><span class="p">(</span><span class="n">USART_TypeDef</span> <span class="o">*</span><span class="n">LPUARTx</span><span class="p">);</span> <span class="cm">/* Enable DMA Mode for reception */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="dma-å¯„å­˜å™¨">DMA å¯„å­˜å™¨<a hidden class="anchor" aria-hidden="true" href="#dma-å¯„å­˜å™¨">#</a></h3>
<ul>
<li><strong>TCIFx</strong>: channle x ä¼ è¾“å®Œæˆ</li>
<li><strong>HTIFx</strong>: channel x ä¼ è¾“ä¸€åŠ</li>
<li><strong>CNDTRx</strong>: éœ€è¦ä¼ è¾“çš„æ•°æ®æ•°é‡ï¼›åªæœ‰ DMA é€šé“ disabled æ—¶æ‰å¯ä»¥å†™å…¥æ•°æ®ï¼›å½“å¯¹åº”é€šé“è¢«å¯ç”¨æ—¶ï¼Œè¯¥å¯„å­˜å™¨å˜æˆåªè¯»ï¼Œè¡¨ç¤ºå¾…ä¼ è¾“æ•°æ®çš„å‰©ä½™ä¸ªæ•°ã€‚æ¯æ¬¡ DMA ä¼ è¾“åï¼Œè¯¥å¯„å­˜å™¨å€¼é€’å‡ï¼›å½“ DMA å·¥ä½œäº Normal æ¨¡å¼æ—¶ï¼Œä¼ è¾“å®Œæˆåè¯¥å¯„å­˜å™¨ä¿æŒä¸º 0ï¼›Circular æ¨¡å¼æ—¶ï¼Œè¯¥å¯„å­˜å™¨åœ¨ä¼ è¾“å®Œæˆåè‡ªåŠ¨é‡ç½®ä¸ºä¸Šæ¬¡è®¾ç½®çš„å€¼ã€‚</li>
</ul>
<h3 id="å‘é€æµç¨‹">å‘é€æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#å‘é€æµç¨‹">#</a></h3>
<p>â€ƒâ€ƒä½¿ç”¨ DMA å‘é€ä¸²å£æ•°æ®çš„è¿‡ç¨‹ï¼šå½“ä¸²å£çš„ TXE è¢«ç½®1æ—¶ï¼ŒDMA å°†æ•°æ®ä» SRAM åŠ è½½åˆ° TDR å¯„å­˜å™¨ã€‚å…¶å…·ä½“é…ç½®è¿‡ç¨‹å¦‚ä¸‹<sup id="fnref1:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>ï¼š</p>
<ol>
<li>é…ç½® DMA ä¼ è¾“çš„<strong>ç›®çš„</strong>åœ°å€ä¸º<strong>TDR</strong>å¯„å­˜å™¨åœ°å€ï¼ˆæ¯æ¬¡ TXE ç½®1æ—¶æ•°æ®éƒ½ä¼šä»å­˜å‚¨åŒºåŠ è½½åˆ° TDR å¯„å­˜å™¨ä¸­ï¼‰ã€‚</li>
<li>é…ç½® DMA ä¼ è¾“çš„<strong>æº</strong>åœ°å€ä¸º<strong>æ•°æ®</strong>åœ°å€ï¼ˆæ¯æ¬¡ TXE ç½®1æ—¶æ•°æ®éƒ½ä¼šä»è¯¥åœ°å€åŠ è½½åˆ° TDR å¯„å­˜å™¨ä¸­ï¼‰ã€‚</li>
<li>é…ç½® DMA ä¼ è¾“çš„æ€»å­—èŠ‚æ•°ï¼ˆå‘é€æ•°æ®å­—èŠ‚ä¸ªæ•°ï¼‰ã€‚</li>
<li>é…ç½® DMA é€šé“çš„ä¼˜å…ˆçº§ã€‚</li>
<li>é…ç½® DMA ä¼ è¾“å®Œæˆ/ä¸€åŠä¸­æ–­ã€‚</li>
<li>æ¸…é™¤ä¸²å£å¯„å­˜å™¨çš„ TC æ ‡å¿—ä½ã€‚ï¼ˆå¦‚æœä½¿èƒ½ DMA ä¼ è¾“ä¹‹å‰å°±ä½¿èƒ½äº† TC ä¸­æ–­ï¼Œåˆ™ä¼šç«‹åˆ»è¿›å…¥ä¸­æ–­ï¼›è‹¥ç­‰åˆ° DMA ä¼ è¾“å®Œæˆåå†ä½¿èƒ½ TC ä¸­æ–­ï¼Œåˆ™å¯ä»¥ä¸åœ¨è¿™ä¸€æ­¥æ¸…é™¤æ ‡å¿—ä½ã€‚ï¼‰</li>
<li>æ¿€æ´» DMA çš„å¯¹åº”é€šé“ã€‚</li>
</ol>
<p>â€ƒâ€ƒå½“ DMA ä¼ è¾“çš„æ•°æ®é‡åˆ°è¾¾è®¾å®šçš„æ•°æ®é‡æ—¶ï¼ˆæ•°æ®è¢«ä¼ é€åˆ° TDR å¯„å­˜å™¨ï¼‰ï¼Œäº§ç”Ÿä¸­æ–­ TCIFï¼Œä½†æ­¤æ—¶æœ€åä¸€ä¸ªæ•°æ®ä»æœªè¢«ä¸²å£å‘é€å®Œæˆï¼›è‹¥è¦ç¦æ­¢ UART æˆ–è¿›å…¥åœæ­¢æ¨¡å¼å‰åº”ç›‘è§†ä¸²å£çš„ TC æ ‡å¿—ä½ä»¥ç¡®ä¿ UART é€šä¿¡æ“ä½œå·²ç»å®Œæˆã€‚</p>
<p><img loading="lazy" src="./images/uart_dma_tx.png" alt="uart_dma_tx"  />
</p>
<h3 id="æ¥æ”¶æµç¨‹">æ¥æ”¶æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#æ¥æ”¶æµç¨‹">#</a></h3>
<p>â€ƒâ€ƒä½¿ç”¨ DMA æ¥æ”¶ä¸²å£æ•°æ®çš„è¿‡ç¨‹ï¼šå½“ä¸²å£çš„ RXNE è¢«ç½®1æ—¶ï¼ŒDMA å°†æ•°æ®ä» RDR å¯„å­˜å™¨åŠ è½½åˆ° SRAMã€‚å…¶å…·ä½“é…ç½®ä¸å‘é€è¿‡ç¨‹ç±»ä¼¼<sup id="fnref2:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>ã€‚</p>
<p><img loading="lazy" src="./images/uart_dma_rx.png" alt="uart_dma_rx"  />
</p>
<h3 id="cubemx-é…ç½®-1">CubeMX é…ç½®<a hidden class="anchor" aria-hidden="true" href="#cubemx-é…ç½®-1">#</a></h3>
<p>â€ƒâ€ƒDMA Settings ä¸­æ·»åŠ  TX å’Œ RXï¼›TX çš„ Mode é€‰æ‹© Normalï¼Œå³å‘é€ä¸€æ¬¡è‡ªåŠ¨åœæ­¢ï¼Œéœ€è¦é‡æ–°é…ç½®æ•°æ®åœ°å€ä¸é•¿åº¦ï¼›RX çš„ Mode é€‰æ‹© Circularï¼Œè¿ç»­æ¥æ”¶ã€‚</p>
<p><img loading="lazy" src="./images/cubemx_lpuart1_dma_tx.png" alt="cubemx_lpuart1_dma_tx"  />
</p>
<p><img loading="lazy" src="./images/cubemx_lpuart1_dma_rx.png" alt="cubemx_lpuart1_dma_rx"  />
</p>
<p>â€ƒâ€ƒå‹¾é€‰ NVIC Settings ä¸­çš„ global interruptã€‚</p>
<p><img loading="lazy" src="./images/cobemx_lpuart_dma_nvic.png" alt="cobemx_lpuart_dma_nvic"  />
</p>
<p>â€ƒâ€ƒè°ƒæ•´ Project Manager ä¸­ Advanced Settingsï¼Œç§»åŠ¨åˆå§‹åŒ–å‡½æ•°çš„è°ƒç”¨é¡ºåºï¼Œç¡®ä¿ MX_DMA_Init åœ¨ MX_xxx_UART_Init ä¹‹å‰ï¼Œå¦åˆ™æ— æ³•è¿›å…¥ DMA ä¼ è¾“è¿‡ç¨‹<sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup>ã€‚</p>
<p><img loading="lazy" src="./images/cubemx_functioncalls.png" alt="cubemx_functioncalls"  />
</p>
<h3 id="ä»£ç -1">ä»£ç <a hidden class="anchor" aria-hidden="true" href="#ä»£ç -1">#</a></h3>
<blockquote>
<p>å‚è€ƒï¼šUSART_Communication_TxRx_DMA<sup id="fnref:9"><a href="#fn:9" class="footnote-ref" role="doc-noteref">9</a></sup>ã€ä¸€ä¸ªä¸¥è°¨çš„STM32ä¸²å£DMAå‘é€&amp;æ¥æ”¶ï¼ˆ1.5Mbpsæ³¢ç‰¹ç‡ï¼‰æœºåˆ¶<sup id="fnref:10"><a href="#fn:10" class="footnote-ref" role="doc-noteref">10</a></sup>ã€usart_rx_idle_line_irq_L4<sup id="fnref:11"><a href="#fn:11" class="footnote-ref" role="doc-noteref">11</a></sup></p>
</blockquote>
<h4 id="å®šé•¿æ¥æ”¶">å®šé•¿æ¥æ”¶<a hidden class="anchor" aria-hidden="true" href="#å®šé•¿æ¥æ”¶">#</a></h4>
<p>â€‚â€‚â€‚â€‚è‹¥è¦åœ¨ DMA ä¸æ”¯æŒåŒç¼“å†²çš„æƒ…å†µä¸‹å®ç°æ•°æ®åŒç¼“å†²å®šé•¿æ¥æ”¶ï¼Œå¯ä»¥ç»“åˆ DMA çš„ HT ä¸­æ–­å®ç°ï¼Œæ­¤æ—¶ç»“æ„ä½“ä¸­çš„ rxData ï¼ˆDMA æ¥æ”¶ç¼“å†²åŒºï¼‰æ•°ç»„é•¿åº¦åº”ä¸ºæ•°æ®é•¿åº¦çš„ä¸€åŠï¼Œé˜²æ­¢å¤„ç†æ•°æ®ä¸åŠæ—¶ä¸€äº›æ•°æ®è¢«ä¸‹ä¸€æ¬¡ DMA ä¼ è¾“è¦†ç›–ã€‚</p>
<h5 id="å®šä¹‰ç»“æ„ä½“-uartdmafixmodel">å®šä¹‰ç»“æ„ä½“ UartDMAFixModel<a hidden class="anchor" aria-hidden="true" href="#å®šä¹‰ç»“æ„ä½“-uartdmafixmodel">#</a></h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="n">rxFlag</span><span class="p">;</span>   <span class="c1">// æ¥æ”¶å®Œä¸€å¸§æ•°æ®æ ‡å¿—ä½ 1: æ¥æ”¶å®Œæˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">rxLen</span><span class="p">;</span>             <span class="c1">// å®šé•¿æ•°æ®å¸§é•¿åº¦, _rx_dma_data çš„ä¸€åŠ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">_rx_dma_data</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>  <span class="c1">// DMA æ¥æ”¶æ•°æ®ç¼“å†²åŒºï¼Œå®šé•¿æ¥æ”¶æ¯æ¬¡åªå¤„ç†ä¸€åŠæ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">rxDataPointer</span><span class="p">;</span>    <span class="c1">// æŒ‡å‘å½“å‰å¯ä»¥å¤„ç†çš„æ•°æ®çš„é¦–åœ°å€, åœ¨ DMA ä¸­æ–­åˆ‡æ¢åœ°å€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="n">txBusy</span><span class="p">;</span>   <span class="c1">// 0: ä¸²å£æ²¡æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€; 1: æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">txData</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>        <span class="c1">// éœ€è¦å‘é€çš„æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ DMA å‘é€çš„ç¼“å†²åŒº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">UartDMAFixModel_1010</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">UartDMAFixModel_1010</span> <span class="n">Lpuart1DMAFixModel</span> <span class="o">=</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">rxFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">rxLen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">_rx_dma_data</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">rxDataPointer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">txBusy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">txData</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">UartDMAFixModel_1010</span> <span class="n">Lpuart1DMAFixModel</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="é…ç½®ä¸²å£-dma-åœ°å€é•¿åº¦ä¸­æ–­">é…ç½®ä¸²å£ DMA åœ°å€ã€é•¿åº¦ã€ä¸­æ–­<a hidden class="anchor" aria-hidden="true" href="#é…ç½®ä¸²å£-dma-åœ°å€é•¿åº¦ä¸­æ–­">#</a></h5>
<p>â€ƒâ€ƒCubeMX ç”Ÿæˆçš„ä»£ç å¹¶ä¸ä¼šé…ç½® DMA çš„å¤–è®¾å’Œå­˜å‚¨å™¨åœ°å€ã€æ•°æ®é•¿åº¦ä»¥åŠç›¸åº”çš„ä¼ è¾“ä¸­æ–­ï¼›ç¼–å†™å¹¶è°ƒç”¨ä¸‹åˆ—ä»£ç ä»¥è®¾å®šä¸²å£ TX å’Œ RX çš„ DMA ç›¸åº”é…ç½®ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @brief extra config LPUART1 TX RX Variable length data reception use DMA
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param None
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @retval None
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_DMAFixConfig</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">LL_DMA_SetPeriphAddress</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_6</span><span class="p">,</span> <span class="nf">LL_LPUART_DMA_GetRegAddr</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">,</span> <span class="n">LL_LPUART_DMA_REG_DATA_TRANSMIT</span><span class="p">));</span> <span class="c1">// tx dma dest address
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_DMA_EnableIT_TC</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_6</span><span class="p">);</span> <span class="c1">// tx dma transfer complete interrupt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// rx dma source address and dest address and length
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_DMA_SetPeriphAddress</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">,</span> <span class="nf">LL_LPUART_DMA_GetRegAddr</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">,</span> <span class="n">LL_LPUART_DMA_REG_DATA_RECEIVE</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nf">LL_DMA_SetMemoryAddress</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">LL_DMA_SetDataLength</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">LL_DMA_EnableIT_TC</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">);</span> <span class="c1">// rx dma transfer complete interrupt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_DMA_EnableIT_HT</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">);</span> <span class="c1">// rx dma half transfer interrupt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nf">LL_DMA_EnableChannel</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">);</span> <span class="c1">// enable uart dma rx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nf">LL_LPUART_EnableDMAReq_TX</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span> <span class="c1">// enable dma to handle uart tdr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_LPUART_EnableDMAReq_RX</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span> <span class="c1">// enable dma to handle uart rdr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="dma-ä¸­æ–­å‡½æ•°ht-tc">DMA ä¸­æ–­å‡½æ•°ï¼ˆHT TCï¼‰<a hidden class="anchor" aria-hidden="true" href="#dma-ä¸­æ–­å‡½æ•°ht-tc">#</a></h5>
<p>â€‚â€‚â€‚â€‚ä½¿ç”¨ DMA çš„ä¼ è¾“å®Œæˆä¸­æ–­å’Œä¼ è¾“åŠå®Œæˆä¸­æ–­å¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œä¸²å£æ•°æ®çš„å®šé•¿æ¥æ”¶ï¼›æ ¹æ®ä¸åŒçš„ DMA æ ‡å¿—ä½è®¾å®šæŒ‡å‘å½“å‰å¯ä»¥å¤„ç†çš„æ•°æ®çš„é¦–åœ°å€ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @brief This function handles DMA2 channel7 global interrupt.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">DMA2_Channel7_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN DMA2_Channel7_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// lpuart1 rx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nf">LL_DMA_IsEnabledIT_HT</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nf">LL_DMA_IsActiveFlag_HT7</span><span class="p">(</span><span class="n">DMA2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_DMA_ClearFlag_HT7</span><span class="p">(</span><span class="n">DMA2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// TODO: uart rx dma half transfer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">rxDataPointer</span> <span class="o">=</span> <span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">_rx_dma_data</span> <span class="o">+</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">rxFlag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">LL_DMA_IsEnabledIT_TC</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nf">LL_DMA_IsActiveFlag_TC7</span><span class="p">(</span><span class="n">DMA2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_DMA_ClearFlag_TC7</span><span class="p">(</span><span class="n">DMA2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// TODO: uart rx dma transfer complete
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">rxDataPointer</span> <span class="o">=</span> <span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">_rx_dma_data</span> <span class="o">+</span> <span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">rxLen</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">rxFlag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END DMA2_Channel7_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN DMA2_Channel7_IRQn 1 */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END DMA2_Channel7_IRQn 1 */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="é‡ç½®-dma-æ¥æ”¶é•¿åº¦">é‡ç½® DMA æ¥æ”¶é•¿åº¦<a hidden class="anchor" aria-hidden="true" href="#é‡ç½®-dma-æ¥æ”¶é•¿åº¦">#</a></h5>
<p>â€‚â€‚â€‚â€‚å¯¹äºå®šé•¿æ•°æ®çš„æ¥æ”¶ï¼Œæ•°æ®æ¥æ”¶å®Œæˆæ˜¯é  DMA çš„ä¼ è¾“ä¸€åŠæˆ–ä¼ è¾“å®Œæˆæ ‡å¿—ä½åˆ¤æ–­çš„ï¼›è‹¥æŸæ¬¡é€šä¿¡æ—¶ï¼Œæ•°æ®å¸§çš„ä¸€ä¸ªå­—èŠ‚ä¸¢å¤±ï¼Œåˆ™ä¼šå¯¼è‡´åç»­çš„æ•°æ®å…¨éƒ¨é”™ä½ï¼Œä»è€Œæ— æ³•æ­£ç¡®è§£æã€‚å› æ­¤åœ¨æ•°æ®å¤„ç†ä¹‹å‰éœ€è¦é€šè¿‡æ ¡éªŒå¸§å¤´æˆ–è€…æ ¡éªŒå’Œç­‰æ–¹å¼åˆ¤æ–­æ•°æ®æ˜¯å¦æœ‰æ•ˆï¼›å½“å‰æ•°æ®å¸§é”™è¯¯æ—¶ï¼Œå¯¹äºä¸‹ä¸€å¸§æ•°æ®åº”é‡æ–°ä» DMA æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹æ¥æ”¶ã€‚</p>
<p>â€‚â€‚â€‚â€‚ä¸‹é¢å‡è®¾æ•°æ®å¸§å¤´å¿…é¡»ä¸º 0x55ï¼Œæ ¡éªŒæˆåŠŸæ—¶ï¼Œå°†æ”¶åˆ°çš„ä¸€å¸§æ•°æ®é€šè¿‡ä¸²å£å‘å›ï¼›å½“æ•°æ®å¸§æ ¡éªŒå¤±è´¥æ—¶ï¼Œå…³é—­ DMA æ¥æ”¶é€šé“å¹¶é‡ç½® DMA æ¥æ”¶æ•°æ®é•¿åº¦ï¼ŒåŒæ—¶æ‰“å¼€ä¸²å£ç©ºé—²ä¸­æ–­ï¼Œç­‰å¾…å½“å‰æ•°æ®å¸§å…¨éƒ¨å‘é€å®Œæˆåé‡æ–°æ‰“å¼€ DMA æ¥æ”¶é€šé“ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @brief Verify data frames and parse data
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param pdata pointer to the first data
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @retval 1: verify success; 0: verify fail
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kt">uint8_t</span> <span class="nf">Lpurat1DataProcess</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">pdata</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint8_t</span> <span class="n">dataValid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Verify data frame
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">pdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x55</span><span class="p">)</span> <span class="c1">// example: frame header must be 0x55
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataValid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataValid</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">dataValid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// The data may be misaligned
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// reset dma rx length
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 1st: disable dma rx channel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">LL_DMA_DisableChannel</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 2nd: reset data length so that new transfer can be placed into the first array element
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">LL_DMA_SetDataLength</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 3rd: enable uart rx idle it, When the current full data frame transmission is complete, re-enable DMA reception.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">LL_LPUART_EnableIT_IDLE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 4th: (in the function UART IRQHandler)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// TODO: data parsing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LPUART1_SendArrayDMA</span><span class="p">(</span><span class="n">pdata</span><span class="p">,</span> <span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">rxLen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€‚â€‚â€‚â€‚ä¸²å£ç©ºé—²ä¸­æ–­å¤„ç†è¿‡ç¨‹ï¼šæ¸…é™¤ç©ºé—²æ ‡å¿—ä½ã€å…³é—­ä¸²å£ç©ºé—²ä¸­æ–­ã€é‡æ–°å¼€å¯ DMA æ¥æ”¶é€šé“ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @brief This function handles LPUART1 global interrupt.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN LPUART1_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="nf">LL_LPUART_IsEnabledIT_IDLE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nf">LL_LPUART_IsActiveFlag_IDLE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_LPUART_ClearFlag_IDLE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 1st-3rd: (in the function Lpurat1DataProcess())
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 4th: disable idle it and re-enable DMA reception.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">LL_LPUART_DisableIT_IDLE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_DMA_EnableChannel</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END LPUART1_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN LPUART1_IRQn 1 */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END LPUART1_IRQn 1 */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="main-1">main<a hidden class="anchor" aria-hidden="true" href="#main-1">#</a></h5>
<p>â€‚â€‚â€‚â€‚æ”¶åˆ°æ•°æ®åï¼Œè°ƒç”¨æ•°æ®å¤„ç†å‡½æ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">rxFlag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// HT or TC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint8_t</span> <span class="n">verifyResult</span> <span class="o">=</span> <span class="nf">Lpurat1DataProcess</span><span class="p">(</span><span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">rxDataPointer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">verifyResult</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// TODO: check verifyResult
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">Lpuart1DMAFixModel</span><span class="p">.</span><span class="n">rxFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ä¸å®šé•¿æ¥æ”¶">ä¸å®šé•¿æ¥æ”¶<a hidden class="anchor" aria-hidden="true" href="#ä¸å®šé•¿æ¥æ”¶">#</a></h4>
<h5 id="å®šä¹‰ç»“æ„ä½“-uartdmavarmodel">å®šä¹‰ç»“æ„ä½“ UartDMAVarModel<a hidden class="anchor" aria-hidden="true" href="#å®šä¹‰ç»“æ„ä½“-uartdmavarmodel">#</a></h5>
<p>â€‚â€‚â€‚â€‚ç»“æ„ä½“ä¸­çš„ rxData æœ€å¥½æ¯”æœ€é•¿çš„æ•°æ®å¸§å¤šå‡ ä¸ªå­—èŠ‚ï¼Œé˜²æ­¢å¤„ç†æ•°æ®ä¸åŠæ—¶ä¸€äº›æ•°æ®è¢«ä¸‹ä¸€æ¬¡ DMA ä¼ è¾“è¦†ç›–ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="n">rxFlag</span><span class="p">;</span>   <span class="c1">// æ¥æ”¶å®Œä¸€å¸§æ•°æ®æ ‡å¿—ä½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">rxLen</span><span class="p">;</span>             <span class="c1">// å½“å‰æ•°æ®å¸§é•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">rxData</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>        <span class="c1">// å½“å‰æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">_rx_dma_data</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>  <span class="c1">// DMA æ¥æ”¶ç¼“å†²åŒº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">_rx_dma_last_used</span><span class="p">;</span> <span class="c1">// ä¸Šä¸€å¸§æ•°æ®ä¼ è¾“å®Œæˆæ—¶DMAçš„ä½¿ç”¨é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="n">txBusy</span><span class="p">;</span>   <span class="c1">// 0: ä¸²å£æ²¡æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€; 1: æœ‰æ•°æ®å¸§æ­£åœ¨å‘é€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint8_t</span> <span class="n">txData</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>        <span class="c1">// éœ€è¦å‘é€çš„æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ DMA å‘é€çš„ç¼“å†²åŒº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">UartDMAVarModel_1010</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">UartDMAVarModel_1010</span> <span class="n">Lpuart1DMAVarModel</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">UartDMAVarModel_1010</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="é…ç½®ä¸²å£-dma-åœ°å€é•¿åº¦ä¸­æ–­-1">é…ç½®ä¸²å£ DMA åœ°å€ã€é•¿åº¦ã€ä¸­æ–­<a hidden class="anchor" aria-hidden="true" href="#é…ç½®ä¸²å£-dma-åœ°å€é•¿åº¦ä¸­æ–­-1">#</a></h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_DMAVarConfig</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @brief extra config LPUART1 TX RX use DMA
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param None
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @retval None
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_DMAVarConfig</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// tx dma dest address
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_DMA_SetPeriphAddress</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_6</span><span class="p">,</span> <span class="nf">LL_LPUART_DMA_GetRegAddr</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">,</span> <span class="n">LL_LPUART_DMA_REG_DATA_TRANSMIT</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// enable dma tx transfer complete interrupt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_DMA_EnableIT_TC</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// rx dma source address and dest address and length
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_DMA_SetPeriphAddress</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">,</span> <span class="nf">LL_LPUART_DMA_GetRegAddr</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">,</span> <span class="n">LL_LPUART_DMA_REG_DATA_RECEIVE</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="nf">LL_DMA_SetMemoryAddress</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">LL_DMA_SetDataLength</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// no need to enable dma rx tc and ht interrupt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// enable uart dma rx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_DMA_EnableChannel</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// enable uart idle interrupt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_LPUART_ClearFlag_IDLE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">LL_LPUART_EnableIT_IDLE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">LL_LPUART_EnableDMAReq_TX</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span> <span class="c1">// enable dma to handle uart tdr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_LPUART_EnableDMAReq_RX</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span> <span class="c1">// enable dma to handle uart rdr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ä¸²å£ä¸­æ–­å‡½æ•°idle-">ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆIDLE ï¼‰<a hidden class="anchor" aria-hidden="true" href="#ä¸²å£ä¸­æ–­å‡½æ•°idle-">#</a></h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @brief This function handles LPUART1 global interrupt.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN LPUART1_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="nf">LL_LPUART_IsEnabledIT_IDLE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nf">LL_LPUART_IsActiveFlag_IDLE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_LPUART_ClearFlag_IDLE</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint8_t</span> <span class="n">dmaTransedLen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">)</span> <span class="o">-</span> <span class="nf">LL_DMA_GetDataLength</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_7</span><span class="p">);</span> <span class="c1">// å½“å‰ DMA å·²ä¼ è¾“æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">dmaTransedLen</span> <span class="o">&gt;</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_last_used</span><span class="p">)</span> <span class="c1">// æœ¬æ¬¡æ•°æ®å¸§ä¼ è¾“è·¨è¿‡äº† DMA æ•°ç»„æœ«å°¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">            * Processing is done in &#34;linear&#34; mode.
</span></span></span><span class="line"><span class="cl"><span class="cm">            *
</span></span></span><span class="line"><span class="cl"><span class="cm">            * Application processing is fast with single data block,
</span></span></span><span class="line"><span class="cl"><span class="cm">            * length is simply calculated by subtracting pointers
</span></span></span><span class="line"><span class="cl"><span class="cm">            *
</span></span></span><span class="line"><span class="cl"><span class="cm">            * [  0  ]
</span></span></span><span class="line"><span class="cl"><span class="cm">            * [  1  ] &lt;- _rx_dma_last_used |-----------------------------------------|
</span></span></span><span class="line"><span class="cl"><span class="cm">            * [  2  ]                      | Single block                            |
</span></span></span><span class="line"><span class="cl"><span class="cm">            * [  3  ]                      | len = dmaTransedLen - _rx_dma_last_used |
</span></span></span><span class="line"><span class="cl"><span class="cm">            * [  4  ]                      |                                         |
</span></span></span><span class="line"><span class="cl"><span class="cm">            * [  5  ]                      |-----------------------------------------|
</span></span></span><span class="line"><span class="cl"><span class="cm">            * [  6  ] &lt;- dmaTransedLen
</span></span></span><span class="line"><span class="cl"><span class="cm">            * [  7  ]
</span></span></span><span class="line"><span class="cl"><span class="cm">            * [N - 1]
</span></span></span><span class="line"><span class="cl"><span class="cm">            */</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// æœ¬æ¬¡ä¼ è¾“é‡ = å½“å‰DMAå·²ä¼ è¾“é‡ - ä¸Šæ¬¡ä¼ è¾“åå‰©ä½™çš„DMAæ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxLen</span> <span class="o">=</span> <span class="n">dmaTransedLen</span> <span class="o">-</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_last_used</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// æ‹·è´ DMA æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">memcpy</span><span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxData</span><span class="p">,</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_data</span> <span class="o">+</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_last_used</span><span class="p">,</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxLen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">             * Processing is done in &#34;overflow&#34; mode..
</span></span></span><span class="line"><span class="cl"><span class="cm">             *
</span></span></span><span class="line"><span class="cl"><span class="cm">             * Application must process data twice,
</span></span></span><span class="line"><span class="cl"><span class="cm">             * since there are 2 linear memory blocks to handle
</span></span></span><span class="line"><span class="cl"><span class="cm">             *
</span></span></span><span class="line"><span class="cl"><span class="cm">             * [  0  ]                      |------------------------------------|
</span></span></span><span class="line"><span class="cl"><span class="cm">             * [  1  ]                      | 2nd block (len = dmaTransedLen)    |
</span></span></span><span class="line"><span class="cl"><span class="cm">             * [  2  ]                      |------------------------------------|
</span></span></span><span class="line"><span class="cl"><span class="cm">             * [  3  ] &lt;- dmaTransedLen
</span></span></span><span class="line"><span class="cl"><span class="cm">             * [  4  ] &lt;- _rx_dma_last_used |------------------------------------|
</span></span></span><span class="line"><span class="cl"><span class="cm">             * [  5  ]                      | 1st block                          |
</span></span></span><span class="line"><span class="cl"><span class="cm">             * [  6  ]                      | len = N - _rx_dma_last_used        |
</span></span></span><span class="line"><span class="cl"><span class="cm">             * [  7  ]                      |                                    |
</span></span></span><span class="line"><span class="cl"><span class="cm">             * [N - 1]                      |------------------------------------|
</span></span></span><span class="line"><span class="cl"><span class="cm">             */</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// æœ¬æ¬¡ä¼ è¾“é‡ = ä¸Šæ¬¡ä¼ è¾“åå‰©ä½™çš„DMAæ•°é‡ + å½“å‰DMAå·²ä¼ è¾“é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxLen</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">)</span> <span class="o">-</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_last_used</span><span class="p">)</span> <span class="o">+</span> <span class="n">dmaTransedLen</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// å…ˆæ‹·è´ä¸Šæ¬¡ä¼ è¾“åå‰©ä½™çš„ DMA æ•°ç»„ rxData &lt;- _rx_dma_data[_rx_dma_last_used]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">memcpy</span><span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxData</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                   <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_data</span> <span class="o">+</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_last_used</span><span class="cm">/* base */</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                   <span class="k">sizeof</span><span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">)</span> <span class="o">-</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_last_used</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// å†æ‹·è´æœ¬æ¬¡ DMA ä¼ è¾“çš„ç”¨é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">memcpy</span><span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxData</span> <span class="o">+</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">)</span> <span class="o">-</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_last_used</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                   <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                   <span class="n">dmaTransedLen</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">_rx_dma_last_used</span> <span class="o">=</span> <span class="n">dmaTransedLen</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxFlag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END LPUART1_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN LPUART1_IRQn 1 */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END LPUART1_IRQn 1 */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="main-2">main<a hidden class="anchor" aria-hidden="true" href="#main-2">#</a></h5>
<p>â€‚â€‚â€‚â€‚ä»¥å›ç¯åº”ç”¨ä¸ºä¾‹ï¼Œå½“æ¥æ”¶åˆ°ä¸€å¸§æ•°æ®åæŠŠæ•°æ®å‘å›ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxFlag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">LPUART1_SendArrayDMA</span><span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxData</span><span class="p">,</span> <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxLen</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">rxFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å‘é€">å‘é€<a hidden class="anchor" aria-hidden="true" href="#å‘é€">#</a></h4>
<p>â€‚â€‚â€‚â€‚ä¸‹é¢ä»¥å®šé•¿æ¥æ”¶çš„ç»“æ„ä½“ä¸ºä¾‹ï¼Œç»™å‡ºä½¿ç”¨ DMA è¿›è¡Œä¸²å£æ•°æ®å‘é€çš„ä»£ç ã€‚DMA çš„åˆå§‹åŒ–è¿‡ç¨‹å·²ç»åœ¨æ¥æ”¶çš„é…ç½®ä¸­é¡ºä¾¿é…ç½®è¿‡äº†ã€‚</p>
<h5 id="å‘é€æ•°æ®-1">å‘é€æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#å‘é€æ•°æ®-1">#</a></h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_SendArrayDMA</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">parr</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_SendArrayDMA</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">parr</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">txBusy</span>  <span class="o">==</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// wait last data transfer complete
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">txBusy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nf">memcpy</span><span class="p">(</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">txData</span><span class="p">,</span> <span class="n">parr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">LL_DMA_SetMemoryAddress</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_6</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">txData</span><span class="p">);</span> <span class="c1">// tx dma mem address
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">LL_DMA_SetDataLength</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_6</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>                                    <span class="c1">// tx dma length
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nf">LL_DMA_EnableChannel</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="dma-ä¸­æ–­å‡½æ•°tc">DMA ä¸­æ–­å‡½æ•°ï¼ˆTCï¼‰<a hidden class="anchor" aria-hidden="true" href="#dma-ä¸­æ–­å‡½æ•°tc">#</a></h5>
<p>â€‚â€‚â€‚â€‚DMA çš„ä¼ è¾“å®Œæˆä¸­æ–­ TC åªèƒ½ä»£è¡¨æŠŠæ‰€æœ‰å¾…å‘é€çš„æ•°æ®éƒ½ä¼ è¾“åˆ°äº†ä¸²å£çš„ TDR å¯„å­˜å™¨ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶æœ€åä¸€å­—èŠ‚æ•°æ®å¹¶æ²¡æœ‰è¢«ä¸²å£å‘é€å®Œæˆï¼›åº”å¼€å¯ä¸²å£å‘é€å®Œæˆä¸­æ–­åˆ¤æ–­æ•°æ®å…¨éƒ¨å‘é€å®Œæˆã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">  * @brief This function handles DMA2 channel6 global interrupt.
</span></span></span><span class="line"><span class="cl"><span class="cm">  */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">DMA2_Channel6_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN DMA2_Channel6_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// lpuart1 tx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nf">LL_DMA_IsEnabledIT_TC</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_6</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nf">LL_DMA_IsActiveFlag_TC6</span><span class="p">(</span><span class="n">DMA2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_DMA_ClearFlag_TC6</span><span class="p">(</span><span class="n">DMA2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_DMA_DisableChannel</span><span class="p">(</span><span class="n">DMA2</span><span class="p">,</span> <span class="n">LL_DMA_CHANNEL_6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_LPUART_EnableIT_TC</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END DMA2_Channel6_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN DMA2_Channel6_IRQn 1 */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END DMA2_Channel6_IRQn 1 */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ä¸²å£ä¸­æ–­å‡½æ•°tc">ä¸²å£ä¸­æ–­å‡½æ•°ï¼ˆTCï¼‰<a hidden class="anchor" aria-hidden="true" href="#ä¸²å£ä¸­æ–­å‡½æ•°tc">#</a></h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">  * @brief This function handles LPUART1 global interrupt.
</span></span></span><span class="line"><span class="cl"><span class="cm">  */</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">LPUART1_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN LPUART1_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="nf">LL_LPUART_IsEnabledIT_TC</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nf">LL_LPUART_IsActiveFlag_TC</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">LL_LPUART_ClearFlag_TC</span><span class="p">(</span><span class="n">LPUART1</span><span class="p">);</span> <span class="cm">/* Clear TC flag */</span>
</span></span><span class="line"><span class="cl">        <span class="n">Lpuart1DMAVarModel</span><span class="p">.</span><span class="n">txBusy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END LPUART1_IRQn 0 */</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE BEGIN LPUART1_IRQn 1 */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* USER CODE END LPUART1_IRQn 1 */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>RM0090_STM32F405415,407417,427437,429439_ReferenceManual | 30.3 USART functional description | p.968&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>RM0351 Reference manual STM32L47xxx, STM32L48xxx, STM32L49xxx and STM32L4Axxx advanced ArmÂ®-based 32-bit MCUs | 40.5.1 USART character description | p.1344-1345&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>RM0351 Reference manual STM32L47xxx, STM32L48xxx, STM32L49xxx and STM32L4Axxx advanced ArmÂ®-based 32-bit MCUs | 40.5.3 USART receiver | p.1350&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>RM0351 Reference manual STM32L47xxx, STM32L48xxx, STM32L49xxx and STM32L4Axxx advanced ArmÂ®-based 32-bit MCUs | 41.4.4 LPUART baud rate generation | p.1419&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>STM32Cube_FW_L4_V1.17.0\Projects\NUCLEO-L496ZG\Examples_LL\USART\USART_Communication_Rx_IT&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>STM32Cube_FW_L4_V1.17.0\Projects\NUCLEO-L496ZG\Examples_LL\USART\USART_Communication_Tx_IT&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7">
<p>RM0351 Reference manual STM32L47xxx, STM32L48xxx, STM32L49xxx and STM32L4Axxx advanced ArmÂ®-based 32-bit MCUs | 41.4.9 Continuous communication in DMA mode using LPUART | p.1425&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref2:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8">
<p><a href="https://blog.csdn.net/ricefat609/article/details/119620557">CUBEMXç”Ÿæˆä»£ç éœ€è¦æ³¨æ„é¡ºåºï¼ŒæŠ˜è…¾STM32+ADC+DMA | CSDN | ricefat609</a>&#160;<a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:9">
<p>STM32Cube_FW_L4_V1.17.0\Projects\NUCLEO-L496ZG\Examples_LL\USART\USART_Communication_TxRx_DMA&#160;<a href="#fnref:9" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:10">
<p><a href="https://acuity.blog.csdn.net/article/details/108367512">ä¸€ä¸ªä¸¥è°¨çš„STM32ä¸²å£DMAå‘é€&amp;æ¥æ”¶ï¼ˆ1.5Mbpsæ³¢ç‰¹ç‡ï¼‰æœºåˆ¶ | CSDN | Acuity.</a>&#160;<a href="#fnref:10" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:11">
<p><a href="https://github.com/MaJerle/stm32-usart-uart-dma-rx-tx/tree/main/projects/usart_rx_idle_line_irq_L4">usart_rx_idle_line_irq_L4 | Github | MaJerle</a>&#160;<a href="#fnref:11" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://fivekernels.github.io/tags/stm32/">STM32</a></li>
      <li><a href="https://fivekernels.github.io/tags/cubemx/">CubeMX</a></li>
      <li><a href="https://fivekernels.github.io/tags/uart/">UART</a></li>
      <li><a href="https://fivekernels.github.io/tags/l4/">L4</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://fivekernels.github.io/posts/openwrt-configuration/">
    <span class="title"> Â»</span>
    <br>
    <span>OpenWrt Configuration</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>Â© 2021-2023 <a href="https://fivekernels.github.io/">èƒ¡å†™ä¹±ç”»</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
